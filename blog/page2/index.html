<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Blog · React Native</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A framework for building native apps using React"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Blog · React Native"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reactnative.dev/"/><meta property="og:description" content="A framework for building native apps using React"/><meta property="og:image" content="https://reactnative.dev/img/logo-og.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://reactnative.dev/img/logo-og.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="/cdn/docsearch.min.css"/><link rel="stylesheet" href="/cdn/solarized-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://reactnative.dev/blog/atom.xml" title="React Native Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://reactnative.dev/blog/feed.xml" title="React Native Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','/cdn/analytics.js','ga');

              ga('create', 'UA-41298772-2', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="/cdn/focus-visible.min.js"></script><script type="text/javascript" src="/cdn/embed.js"></script><script type="text/javascript" src="/cdn/widgets.js"></script><script type="text/javascript" src="/js/codeblocks.js"></script><script type="text/javascript" src="/js/tabs.js"></script><script type="text/javascript" src="/js/docs-rating.js"></script><script src="/cdn/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="blog"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/header_logo.svg" alt="React Native"/><h2 class="headerTitleWithLogo">React Native</h2></a><a href="/versions"><h3>0.62</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="/docs/activityindicator" target="_self">API</a></li><li class=""><a href="/help" target="_self">Community</a></li><li class="siteNavGroupActive siteNavItemActive"><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/facebook/react-native" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>All Blog Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">All Blog Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/blog/2020/03/26/version-0.62">Announcing React Native 0.62 with Flipper</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/11/18/react-native-doctor">Meet Doctor, a new React Native command</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/09/18/version-0.61">Announcing React Native 0.61 with Fast Refresh</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/07/17/hermes">Meet Hermes, a new JavaScript Engine optimized for React Native</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/07/03/version-60">Announcing React Native 0.60</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/06/12/react-native-open-source-update">React Native Open Source Update June 2019</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/05/01/react-native-at-f8-and-podcast">React Native at F8 and Open Source Podcast</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/03/12/releasing-react-native-059">Releasing React Native 0.59</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/03/01/react-native-open-source-update">React Native Open Source Update March 2019</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/01/07/state-of-react-native-community">The State of the React Native Community in 2018</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/11/01/oss-roadmap">Open Source Roadmap</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/08/27/wkwebview">Introducing new iOS WebViews</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/08/13/react-native-accessibility-updates">Accessibility API Updates</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/07/04/releasing-react-native-056">Releasing 0.56</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/06/14/state-of-react-native-2018">State of React Native 2018</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/05/07/using-typescript-with-react-native">Using TypeScript with React Native</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/04/09/build-com-app">Built with React Native - The Build.com app</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/03/22/building-input-accessory-view-for-react-native">Building &lt;InputAccessoryView&gt; For React Native</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/03/05/AWS-app-sync">Using AWS with React Native</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/01/18/implementing-twitters-app-loading-animation-in-react-native">Implementing Twitter’s App Loading Animation in React Native</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/01/09/react-native-monthly-6">React Native Monthly #6</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/11/06/react-native-monthly-5">React Native Monthly #5</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/09/21/react-native-monthly-4">React Native Monthly #4</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/08/30/react-native-monthly-3">React Native Monthly #3</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/08/07/react-native-performance-in-marketplace">React Native Performance in Marketplace</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/07/28/react-native-monthly-2">React Native Monthly #2</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/06/21/react-native-monthly-1">React Native Monthly #1</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/03/13/introducing-create-react-native-app">Introducing Create React Native App</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/03/13/idx-the-existential-function">idx: The Existential Function</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/03/13/better-list-views">Better List Views in React Native</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/02/14/using-native-driver-for-animated">Using Native Driver for Animated</a></li><li class="navListItem"><a class="navItem" href="/blog/2017/01/07/monthly-release-cadence">A Monthly Release Cadence: Releasing December and January RC</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/12/05/easier-upgrades">Easier Upgrades Thanks to Git</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/11/08/introducing-button-yarn-and-a-public-roadmap">Introducing Button, Faster Installs with Yarn, and a Public Roadmap</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/10/25/0.36-headless-js-the-keyboard-api-and-more">0.36: Headless JS, the Keyboard API, &amp; more</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/09/08/exponent-talks-unraveling-navigation">Expo Talks: Adam on Unraveling Navigation</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/08/19/right-to-left-support-for-react-native-apps">Right-to-Left Layout Support For React Native Apps</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/08/12/react-native-meetup-san-francisco">San Francisco Meetup Recap</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/07/06/toward-better-documentation">Toward Better Documentation</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/04/13/react-native-a-year-in-review">React Native: A year in review</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/03/28/dive-into-react-native-performance">Dive into React Native Performance</a></li><li class="navListItem"><a class="navItem" href="/blog/2016/03/24/introducing-hot-reloading">Introducing Hot Reloading</a></li><li class="navListItem"><a class="navItem" href="/blog/2015/11/23/making-react-native-apps-accessible">Making React Native apps accessible</a></li><li class="navListItem"><a class="navItem" href="/blog/2015/09/14/react-native-for-android">React Native for Android: How we built the first cross-platform React Native app</a></li><li class="navListItem"><a class="navItem" href="/blog/2015/03/26/react-native-bringing-modern-web-techniques-to-mobile">React Native: Bringing modern web techniques to mobile</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="posts"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/11/01/oss-roadmap">Open Source Roadmap</a></h1><p class="post-meta">November 1, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://hectorramos.com/about" target="_blank" rel="noreferrer noopener">Héctor Ramos</a>Engineer at Facebook</p><div class="authorPhoto authorPhotoBig"><a href="https://hectorramos.com/about" target="_blank" rel="noreferrer noopener"><img src="https://s.gravatar.com/avatar/f2223874e66e884c99087e452501f2da?s=128" alt="Héctor Ramos"/></a></div></div></header><article class="post-content"><div><span><p><img src="/blog/assets/oss-roadmap-hero.jpg" alt=""></p>
<p>This year, the React Native team has focused on a large scale <a href="https://github.com/react-native-community/discussions-and-proposals/issues/4">re-architecture of React Native</a>. As Sophie mentioned in her <a href="/blog/2018/06/14/state-of-react-native-2018">State of React Native post,</a> we've sketched out a plan to better support the thriving population of React Native users and collaborators outside of Facebook. It's now time to share more details about what we've been working on. Before I do so, I'd like to lay out our long-term vision for React Native in open source.</p>
<p>Our vision for React Native is...</p>
<ul>
<li><strong>A healthy GitHub repository.</strong> Issues and pull requests get handled within a reasonable period of time.
<ul>
<li>Increased test coverage.</li>
<li>Commits that sync out from the Facebook code repository should not break open source tests.</li>
<li>A higher scale of meaningful community contributions.</li>
</ul></li>
<li><strong>Stable APIs,</strong> making it easier to interface with open source dependencies.
<ul>
<li>Facebook uses the same public API as open source</li>
<li>React Native releases that follow semantic versioning.</li>
</ul></li>
<li><strong>A vibrant eco-system.</strong> High quality ViewManagers, native modules, and multiple platform support maintained by the community.</li>
<li><strong>Excellent documentation.</strong> Focus on helping users create high quality experiences, and up-to-date API reference docs.</li>
</ul>
<p>We have identified the following focus areas to help us achieve this vision.</p>
<h2><a class="anchor" aria-hidden="true" id="️-lean-core"></a><a href="#️-lean-core" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>✂️ Lean Core</h2>
<p>Our goal is to <a href="https://github.com/react-native-community/discussions-and-proposals/issues/6">reduce the surface area of React Native</a> by removing non-core and unused components. We'll transfer non-core components to the community to allow it to move faster. The reduced surface area will make it easier to manage contributions to React Native.</p>
<p><a href="https://github.com/react-native-community/discussions-and-proposals/blob/master/proposals/0001-webview.md"><code>WebView</code></a> is an example of a component that we transferred to the community. We are working on a workflow that will allow internal teams to continue using these components after we remove them from the repository. We have identified <a href="https://github.com/react-native-community/discussions-and-proposals/issues/6">dozens more components</a> that we'll give ownership of to the community.</p>
<h2><a class="anchor" aria-hidden="true" id="-open-sourcing-internals-and-updated-tooling"></a><a href="#-open-sourcing-internals-and-updated-tooling" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>🎁 Open Sourcing Internals and 🛠Updated Tooling</h2>
<p>The React Native development experience for product teams at Facebook can be quite different from open source. Tools that may be popular in the open source community are not used at Facebook. There may be an internal tool that achieves the same purpose. In some cases, Facebook teams have become used to tools that do not exist outside of Facebook. These disparities can pose challenges when we open source our upcoming architecture work.</p>
<p>We'll work on releasing some of these internal tools. We'll also improve support for tools popular with the open source community. Here's a non-exhaustive list of projects we'll tackle:</p>
<ul>
<li>Open source JSI and enable the community to bring their own JavaScript VMs, replacing the existing JavaScriptCore from RN's initial release. We'll be covering what JSI is in a future post, in the meantime you can learn more about JSI from <a href="https://www.youtube.com/watch?v=UcqRXTriUVI">Parashuram's talk at React Conf</a>.</li>
<li>Support 64-bit libraries on Android.</li>
<li>Enable debugging under the new architecture.</li>
<li>Improve support for CocoaPods, Gradle, Maven, and new Xcode build system.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="-testing-infrastructure"></a><a href="#-testing-infrastructure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>✅ Testing Infrastructure</h2>
<p>When Facebook engineers publish code, it's considered safe to land if it passes all tests. These tests identify whether a change might break one of our own React Native surfaces. Yet, there are differences in how Facebook uses React Native. This has allowed us to unknowingly break React Native in open source.</p>
<p>We'll shore up our internal tests to ensure they run in an environment that is as close as possible to open source. This will help prevent code that breaks these tests from making it to open source. We will also work on infrastructure to enable better testing of the core repo on GitHub, enabling future pull requests to easily include tests.</p>
<p>Combined with the reduced surface area, this will allow contributors to merge pull requests quicker, with confidence.</p>
<h2><a class="anchor" aria-hidden="true" id="-public-api"></a><a href="#-public-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>📜 Public API</h2>
<p>Facebook will consume React Native via the public API, the same way open source does, to reduce unintentional breaking changes. We have started converting internal call sites to address this. Our goal is to converge on a stable, public API, leading to the adoption of semantic versioning in version 1.0.</p>
<h2><a class="anchor" aria-hidden="true" id="-communication"></a><a href="#-communication" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>📣 Communication</h2>
<p>React Native is one of the <a href="https://octoverse.github.com/#top-and-trending-projects">top open source projects on GitHub</a> by contributor count. That makes us really happy, and we'd like to keep it going. We'll continue working on initiatives that lead to involved contributors, such as increased transparency and open discussion. The documentation is one of the first things someone new to React Native will encounter, yet it has not been a priority. We'd like to fix that, starting with bringing back auto-generated API reference docs, creating additional content focused on creating <a href="/docs/improvingux">quality user experiences</a>, and improving our <a href="https://github.com/react-native-community/react-native-releases/issues/47">release notes</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="timeline"></a><a href="#timeline" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Timeline</h2>
<p>We're planning to land these projects throughout the next year or so. Some of these efforts are already ongoing, such as <a href="https://github.com/facebook/react-native/compare/e337bcafb0b017311c37f2dbc24e5a757af0a205...8427f64e06456f171f9df0316c6ca40613de7a20">JSI which has already landed in open source</a>. Others will take a bit longer to complete, such as reducing the surface area. We'll do our best to keep the community up to date with our progress. Please join us in the <a href="https://github.com/react-native-community/discussions-and-proposals">Discussions and Proposals</a> repository, a initiative from the React Native community that has led to the creation of several of the initiatives discussed in this roadmap.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/08/27/wkwebview">Introducing new iOS WebViews</a></h1><p class="post-meta">August 27, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://github.com/rsnara" target="_blank" rel="noreferrer noopener">Ramanpreet Nara</a>Software Engineer at Facebook</p></div></header><article class="post-content"><div><span><p>For a long time now, Apple has discouraged using UIWebViews in favor of WKWebView. In iOS 12, which will be released in the upcoming months, <a href="https://developer.apple.com/videos/play/wwdc2018/234/?time=104">UIWebViews will be formally deprecated</a>. React Native's iOS WebView implementation relies heavily on the UIWebView class. Therefore, in light of these developments, we've built a new native iOS backend to the WebView React Native component that uses WKWebView.</p>
<p>The tail end of these changes were landed in <a href="https://github.com/facebook/react-native/commit/33b353c97c31190439a22febbd3d2a9ead49d3c9">this commit</a>, and will become available in the 0.57 release.</p>
<p>To opt into this new implementation, please use the <a href="/docs/next/webview#usewebkit"><code>useWebKit</code></a> prop:</p>
<pre><code class="hljs css language-js"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WebView</span></span>
  <span class="token attr-name">useWebKit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">source</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> url<span class="token punctuation">:</span> <span class="token string">'https://www.google.com'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="token punctuation">/></span></span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="improvements"></a><a href="#improvements" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Improvements</h2>
<p><code>UIWebView</code> had no legitimate way to facilitate communication between the JavaScript running in the WebView, and React Native. When messages were sent from the WebView, we relied on a hack to deliver them to React Native. Succinctly, we encoded the message data into a url with a special scheme, and navigated the WebView to it. On the native side, we intercepted and cancelled this navigation, parsed the data from the url, and finally called into React Native. This implementation was error prone and insecure. I'm glad to announce that we've leveraged <code>WKWebView</code> features to completely replace it.</p>
<p>Other benefits of WKWebView over UIWebView include faster JavaScript execution, and a multi-process architecture. Please see this <a href="https://developer.apple.com/videos/play/wwdc2014/206">2014 WWDC</a> for more details.</p>
<h2><a class="anchor" aria-hidden="true" id="caveats"></a><a href="#caveats" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Caveats</h2>
<p>If your components use the following props, then you may experience problems when switching to WKWebView. For the time being, we suggest that you avoid using these props:</p>
<p><strong>Inconsistent behavior:</strong></p>
<p><code>automaticallyAdjustContentInsets</code> and <code>contentInsets</code> (<a href="https://github.com/facebook/react-native/commit/bacfd9297657569006bab2b1f024ad1f289b1b27">commit</a>)</p>
<p>When you add contentInsets to a <code>WKWebView</code>, it doesn't change the <code>WKWebView</code>'s viewport. The viewport remains the same size as the frame. With <code>UIWebView</code>, the viewport size actually changes (gets smaller, if the content insets are positive).</p>
<p><code>backgroundColor</code> (<a href="https://github.com/facebook/react-native/commit/215fa14efc2a817c7e038075163491c8d21526fd">commit</a>)</p>
<p>With the new iOS implementation of WebView, there's a chance that your background color will flicker into view if you use this property. Furthermore, <code>WKWebView</code> renders transparent backgrounds differently from <code>UIWebview</code>. Please look at the commit description for more details.</p>
<p><strong>Not supported:</strong></p>
<p><code>scalesPageToFit</code> (<a href="https://github.com/facebook/react-native/commit/b18fddadfeae5512690a0a059a4fa80c864f43a3">commit</a>)</p>
<p>WKWebView didn't support the scalesPageToFit prop, so we couldn't implement this on the WebView React Native component.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/08/13/react-native-accessibility-updates">Accessibility API Updates</a></h1><p class="post-meta">August 13, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://ziqichen.com/" target="_blank" rel="noreferrer noopener">Ziqi Chen</a>Student at UC Berkeley</p><div class="authorPhoto authorPhotoBig"><a href="https://ziqichen.com/" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/13990087?s=400&amp;u=5841da1b6064341d52ecab70a586b6701d9f6978&amp;v=4" alt="Ziqi Chen"/></a></div></div></header><article class="post-content"><div><span><h2><a class="anchor" aria-hidden="true" id="motivation"></a><a href="#motivation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Motivation</h2>
<p>As technology advances and mobile apps become increasingly important to everyday life, the necessity of creating accessible applications has likewise grown in importance.</p>
<p>React Native's limited Accessibility API has always been a huge pain point for developers, so we've made a few updates to the Accessibility API to make it easier to create inclusive mobile applications.</p>
<h2><a class="anchor" aria-hidden="true" id="problems-with-the-existing-api"></a><a href="#problems-with-the-existing-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Problems With the Existing API</h2>
<h3><a class="anchor" aria-hidden="true" id="problem-one-two-completely-different-yet-similar-props---accessibilitycomponenttype-android-and-accessibilitytraits-ios"></a><a href="#problem-one-two-completely-different-yet-similar-props---accessibilitycomponenttype-android-and-accessibilitytraits-ios" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Problem One: Two Completely Different Yet Similar Props - accessibilityComponentType (Android) and accessibilityTraits (iOS)</h3>
<p><code>accessibilityComponentType</code> and <code>accessibilityTraits</code> are two properties that are used to tell TalkBack on Android and VoiceOver on iOS what kind of UI element the user is interacting with. The two biggest problems with these properties are that:</p>
<ol>
<li><strong>They are two different properties with different usage methods, yet have the same purpose.</strong> In the previous API, these are two separate properties (one for each platform), which was not only inconvenient, but also confusing to many developers. <code>accessibilityTraits</code> on iOS allows 17 different values while <code>accessibilityComponentType</code> on Android allows only 4 values. Furthermore, the values for the most part had no overlap. Even the input types for these two properties are different. <code>accessibilityTraits</code> allows either an array of traits to be passed in or a single trait, while <code>accessibilityComponentType</code> allows only a single value.</li>
<li><strong>There is very limited functionality on Android.</strong> With the old property, the only UI elements that Talkback were able to recognize were “button,” “radiobutton_checked,” and “radiobutton_unchecked.”</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="problem-two-non-existent-accessibility-hints"></a><a href="#problem-two-non-existent-accessibility-hints" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Problem Two: Non-existent Accessibility Hints:</h3>
<p>Accessibility Hints help users using TalkBack or VoiceOver understand what will happen when they perform an action on an accessibility element that is not apparent by only the accessibility label. These hints can be turned on and off in the settings panel. Previously, React Native's API did not support accessibility hints at all.</p>
<h3><a class="anchor" aria-hidden="true" id="problem-three-ignoring-inverted-colors"></a><a href="#problem-three-ignoring-inverted-colors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Problem Three: Ignoring Inverted Colors:</h3>
<p>Some users with vision loss use inverted colors on their mobile phones to have greater screen contrast. Apple provided an API for iOS which allows developers to ignore certain views. This way, images and videos aren't distorted when a user has the inverted colors setting on. This API is currently unsupported by React Native.</p>
<h2><a class="anchor" aria-hidden="true" id="design-of-the-new-api"></a><a href="#design-of-the-new-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Design of the New API</h2>
<h3><a class="anchor" aria-hidden="true" id="solution-one-combining-accessibilitycomponenttype-android-and-accessibilitytraits-ios"></a><a href="#solution-one-combining-accessibilitycomponenttype-android-and-accessibilitytraits-ios" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solution One: Combining accessibilityComponentType (Android) and accessibilityTraits (iOS)</h3>
<p>In order to solve the confusion between <code>accessibilityComponentType</code> and <code>accessibilityTraits</code>, we decided to merge them into a single property. This made sense because they technically had the same intended functionality and by merging them, developers no longer had to worry about platform specific intricacies when building accessibility features.</p>
<p><strong>Background</strong></p>
<p>On iOS, <code>UIAccessibilityTraits</code> is a property that can be set on any NSObject. Each of the 17 traits passed in through the javascript property to native is mapped to a <code>UIAccessibilityTraits</code> element in Objective-C. Traits are each represented by a long int, and every trait that is set is ORed together.</p>
<p>On Android however, <code>AccessibilityComponentType</code> is a concept that was made up by React Native, and doesn't directly map to any properties in Android. Accessibility is handled by an accessibility delegate. Each view has a default accessibility delegate. If you want to customize any accessibility actions, you have to create a new accessibility delegate, override specific methods you want to customize, and then set the accessibility delegate of the view you are handling to be associated with the new delegate. When a developer set <code>AccessibilityComponentType</code>, the native code created a new delegate based off of the component that was passed in, and set the view to have that accessibility delegate.</p>
<p><strong>Changes Made</strong></p>
<p>For our new property, we wanted to create a superset of the two properties. We decided to keep the new property modeled mostly after the existing property <code>accessibilityTraits</code>, since <code>accessibilityTraits</code> has significantly more values. The functionality of Android for these traits would be polyfilled in by modifying the Accessibility Delegate.</p>
<p>There are 17 values of UIAccessibilityTraits that <code>accessibilityTraits</code> on iOS can be set to. However, we didn't include all of them as possible values to our new property. This is because the effect of setting some of these traits is actually not very well known, and many of these values are virtually never used.</p>
<p>The values UIAccessibilityTraits were set to generally took on one of two purposes. They either described a role that UI element had, or they described the state a UI element was in. Most uses of the previous properties we observed usually used one value that represented a role and combined it with either “state selected,” “state disabled,” or both. Therefore, we decided to create two new accessibility properties: <code>accessibilityRole</code> and <code>accessibilityState</code>.</p>
<p><strong><code>accessibilityRole</code></strong></p>
<p>The new property, <code>accessibilityRole</code>, is used to tell Talkback or Voiceover the role of a UI Element. This new property can take on one of the following values:</p>
<ul>
<li><code>none</code></li>
<li><code>button</code></li>
<li><code>link</code></li>
<li><code>search</code></li>
<li><code>image</code></li>
<li><code>keyboardkey</code></li>
<li><code>text</code></li>
<li><code>adjustable</code></li>
<li><code>header</code></li>
<li><code>summary</code></li>
<li><code>imagebutton</code></li>
</ul>
<p>This property only allows one value to be passed in because UI elements generally don't logically take on more than one of these. The exception is image and button, so we've added a role imagebutton that is a combination of both.</p>
<p><strong><code>accessibilityStates</code></strong></p>
<p>The new property, <code>accessibilityStates</code>, is used to tell Talkback or Voiceover the state a UI Element is in. This property takes on an Array containing one or both of the following values:</p>
<ul>
<li><code>selected</code></li>
<li><code>disabled</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="solution-two-adding-accessibility-hints"></a><a href="#solution-two-adding-accessibility-hints" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solution Two: Adding Accessibility Hints</h3>
<p>For this, we added a new property, <code>accessibilityHint</code>. Setting this property will allow Talkback or Voiceover to recite the hint to users.</p>
<p><strong><code>accessibilityHint</code></strong></p>
<p>This property takes in the accessibility hint to be read in the form of a String.</p>
<p>On iOS, setting this property will set the corresponding native property AccessibilityHint on the view. The hint will then be read by Voiceover if Accessibility Hints are turned on in the iPhone.</p>
<p>On Android, setting this property appends the value of the hint to the end of the accessibility label. The upside to this implementation is that it mimics the behavior of hints on iOS, but the downside to this implementation is that these hints cannot be turned off in the settings on Android the way they can be on iOS.</p>
<p>The reason we made this decision on Android is because normally, accessibility hints correspond with a specific action (e.g. click), and we wanted to keep behaviors consistent across platforms.</p>
<h3><a class="anchor" aria-hidden="true" id="solution-to-problem-three"></a><a href="#solution-to-problem-three" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solution to Problem Three</h3>
<p><strong><code>accessibilityIgnoresInvertColors</code></strong></p>
<p>We exposed Apple's api AccessibilityIgnoresInvertColors to JavaScript, so now when you have a view where you don't want colors to be inverted (e.g image), you can set this property to true, and it won't be inverted.</p>
<h2><a class="anchor" aria-hidden="true" id="new-usage"></a><a href="#new-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New Usage</h2>
<p>These new properties will become available in the React Native 0.57 release.</p>
<h3><a class="anchor" aria-hidden="true" id="how-to-upgrade"></a><a href="#how-to-upgrade" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to Upgrade</h3>
<p>If you are currently using <code>accessibilityComponentType</code> and <code>accessibilityTraits</code>, here are the steps you can take to upgrade to the new properties.</p>
<h4><a class="anchor" aria-hidden="true" id="1-using-jscodeshift"></a><a href="#1-using-jscodeshift" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Using jscodeshift</h4>
<p>The most simple use cases can be replaced by running a jscodeshift script.</p>
<p>This <a href="https://gist.github.com/ziqichen6/246e5778617224d2b4aff198dab0305d">script</a> replaces the following instances:</p>
<pre><code class="hljs">accessibilityTraits=“trait”
accessibilityTraits={[“trait”]}
</code></pre>
<p>With</p>
<pre><code class="hljs">accessibilityRole= “trait”
</code></pre>
<p>This script also removes instances of <code>AccessibilityComponentType</code> (assuming everywhere you set <code>AccessibilityComponentType</code>, you would also set <code>AccessibilityTraits</code>).</p>
<h4><a class="anchor" aria-hidden="true" id="2-using-a-manual-codemod"></a><a href="#2-using-a-manual-codemod" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Using a manual codemod</h4>
<p>For the cases that used <code>AccessibilityTraits</code> that don't have a corresponding value for <code>AccessibilityRole</code>, and the cases where multiple traits were passed into <code>AccessibilityTraits</code>, a manual codemod would have to be done.</p>
<p>In general,</p>
<pre><code class="hljs">accessibilityTraits= {[“button”, “selected”]}
</code></pre>
<p>would be manually replaced with</p>
<pre><code class="hljs">accessibilityRole=“button”
accessibilityStates={[“selected”]}
</code></pre>
<p>These properties are already being used in Facebook's codebase. The codemod for Facebook was surprisingly simple. The jscodeshift script fixed about half of our instances, and the other half was fixed manually. Overall, the entire process took less than a few hours.</p>
<p>Hopefully you will find the updated API useful! And please continue making apps accessible! #inclusion</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/07/04/releasing-react-native-056">Releasing 0.56</a></h1><p class="post-meta">July 4, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://github.com/kelset" target="_blank" rel="noreferrer noopener">Lorenzo Sciandra</a>Core Maintainer &amp; React Native Developer at Drivetribe</p><div class="authorPhoto authorPhotoBig"><a href="https://github.com/kelset" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/16104054?s=460&amp;v=4" alt="Lorenzo Sciandra"/></a></div></div></header><article class="post-content"><div><span><p>The long-awaited 0.56 version of React Native is now available 🎉. This blog post highlights some of the <a href="https://github.com/react-native-community/react-native-releases/blob/master/CHANGELOG.md#highlights">changes</a> introduced in this new release. We also want to take the opportunity to explain what has kept us busy since March.</p>
<h3><a class="anchor" aria-hidden="true" id="the-breaking-changes-dilemma-or-when-to-release"></a><a href="#the-breaking-changes-dilemma-or-when-to-release" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The breaking changes dilemma, or, &quot;when to release?&quot;</h3>
<p>The <a href="/docs/contributing#our-development-process">Contributor's Guide</a> explains the integration process that all changes to React Native go through. The project has is composed by <a href="https://github.com/facebook/react-native-website/issues/370">many different tools</a>, requiring coordination and constant support to keep everything working properly. Add to this the vibrant open source community that contributes back to the project, and you will get a sense of the mind-bending scale of it all.</p>
<p>With React Native's impressive adoption, breaking changes must be made with great care, and the process is not as smooth as we'd like. A decision was made to skip the April and May releases to allow the core team to integrate and test a new set of breaking changes. <a href="https://github.com/react-native-community/react-native-releases/issues/14">Dedicated community communication</a> channels were used along the way to ensure that the June 2018 (<code>0.56.0</code>) release is as hassle-free as possible to adopt by those who patiently waited for the stable release.</p>
<p>Is <code>0.56.0</code> perfect? No, as every piece of software out there: but we reached a point where the tradeoff between &quot;waiting for more stability&quot; versus &quot;testing led to successful results so we can push forward&quot; that we feel ready to release it. Moreover, we are aware <a href="https://github.com/facebook/react-native/issues/19955">of</a> <a href="https://github.com/facebook/react-native/issues/19827">a</a> <a href="https://github.com/facebook/react-native/issues/19763">few</a> <a href="https://github.com/facebook/react-native/issues/19859">issues</a> that are not solved in the final <code>0.56.0</code> release. Most developers should have no issues upgrading to <code>0.56.0</code>. For those that are blocked by the aforementioned issues, we hope to see you around in our discussions and we are looking forward to working with you on a solution to these issues.</p>
<p>You might consider <code>0.56.0</code> as a fundamental building block towards a more stable framework: it will take probably a week or two of widespread adoption before all the edge cases will be sanded off, but this will lead to an even better July 2018 (<code>0.57.0</code>) release.</p>
<p>We'd like to conclude this section by thanking <a href="https://github.com/facebook/react-native/compare/v0.55.4...v0.56.0-rc.4">all the 67 contributors who worked on a total of 818 commits</a> (!) that will help make your apps even better 👏.</p>
<p>And now, without further ado...</p>
<h2><a class="anchor" aria-hidden="true" id="the-big-changes"></a><a href="#the-big-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Big Changes</h2>
<h3><a class="anchor" aria-hidden="true" id="babel-7"></a><a href="#babel-7" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Babel 7</h3>
<p>As you may know, the transpiler tool that allows us all to use the latest and greatest features of JavaScript, Babel, is moving to <a href="https://babeljs.io/blog/2017/12/27/nearing-the-7.0-release">v7 soon</a>. Since this new version brings along some important changes, we felt that now it would be a good time to upgrade, allowing <a href="https://github.com/facebook/metro">Metro</a> to <a href="https://github.com/facebook/metro/issues/92">leverage on its improvements</a>.</p>
<p>If you find yourself in trouble with upgrading, please refer to the <a href="https://new.babeljs.io/docs/en/next/v7-migration.html">documentation section related to it</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="modernizing-android-support"></a><a href="#modernizing-android-support" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Modernizing Android support</h3>
<p>On Android, much of the surrounding tooling has changed. We've updated to <a href="https://github.com/facebook/react-native/commit/699e5eebe807d1ced660d2d2f39b5679d26925da">Gradle 3.5</a>, <a href="https://github.com/facebook/react-native/commit/065c5b6590de18281a8c592a04240751c655c03c">Android SDK 26</a>, <a href="https://github.com/facebook/react-native/commit/6b07602915157f54c39adbf0f9746ac056ad2d13">Fresco to 1.9.0, and OkHttp to 3.10.0</a> and even the <a href="https://github.com/facebook/react-native/commit/5ae97990418db613cd67b1fb9070ece976d17dc7">NDK API target to API 16</a>. These changes should go without issue and result in faster builds. More importantly, it will help developers comply with the <a href="https://android-developers.googleblog.com/2017/12/improving-app-security-and-performance.html">new Play Store requirements</a> coming into effect next month.</p>
<p>Related to this, we'd like to particularly thank <a href="https://github.com/dulmandakh">Dulmandakh</a> for the many PRs submitted in order to make it possible 👏.</p>
<p>There are some more steps that need to be taken in this direction, and you can follow along with the future planning and discussion of updating the Android support in the <a href="https://github.com/facebook/react-native/issues/19297">dedicated issue</a> (and a side one for the <a href="https://github.com/facebook/react-native/issues/19737">JSC</a>).</p>
<h3><a class="anchor" aria-hidden="true" id="new-node-xcode-react-and-flow--oh-my"></a><a href="#new-node-xcode-react-and-flow--oh-my" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New Node, Xcode, React, and Flow – oh my!</h3>
<p>Node 8 is now the standard for React Native. It was actually already being tested already, but we've put both feet forward as Node 6 entered maintenance mode. React was also updated to 16.4, which brings a ton of fixes with it.</p>
<p>We're dropping support for iOS 8, <a href="https://github.com/facebook/react-native/commit/f50df4f5eca4b4324ff18a49dcf8be3694482b51">making iOS 9 the oldest iOS version that can be targeted</a>. We do not foresee this being a problem, as any device that can run iOS 8, can be upgraded to iOS 9. This change allowed us to remove rarely-used code that implemented workarounds for older devices running iOS 8.</p>
<p>The continuous integration toolchain has been updated <a href="https://github.com/facebook/react-native/commit/c55bcd6ea729cdf57fc14a5478b7c2e3f6b2a94d">to use Xcode 9.4</a>, ensuring that all iOS tests are run on the latest developer tools provided by Apple.</p>
<p>We have upgraded to <a href="https://github.com/facebook/react-native/commit/6264b6932a08e1cefd83c4536ff7839d91938730">Flow 0.75</a> to use the new error format <a href="https://twitter.com/dan_abramov/status/998610821096857602">that many devs appreciate</a>. We've also created types for many more components. If you're not yet enforcing static typing in your project, please consider using Flow to identify problems as you code instead of at runtime.</p>
<h3><a class="anchor" aria-hidden="true" id="and-a-lot-of-other-things"></a><a href="#and-a-lot-of-other-things" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>And a lot of other things...</h3>
<p>For instance, YellowBox was <a href="https://github.com/facebook/react-native/commit/d0219a0301e59e8b0ef75dbd786318d4b4619f4c">replaced</a> with a new implementation that makes debugging a lot better.</p>
<p>For the complete release notes, please reference the full <a href="https://github.com/react-native-community/react-native-releases/blob/master/CHANGELOG.md">changelog here</a>. And remember to keep an eye on the <a href="/docs/upgrading.html">upgrading guide</a> to avoid issues moving to this new version.</p>
<hr>
<p>A final note: starting this week, the React Native core team will resume holding monthly meetings. We'll make sure to keep everyone up-to-date with what's covered, and ensure to keep your feedback at hand for future meetings.</p>
<p>Happy coding everyone!</p>
<p><a href="https://twitter.com/Kelset">Lorenzo</a>, <a href="https://github.com/turnrye">Ryan</a>, and the whole <a href="https://twitter.com/reactnative">React Native core team</a></p>
<p><strong>PS:</strong> as always, we'd like to remind everyone that React Native is still in 0.x versioning because of the many changes still undergoing - so remember when upgrading that yes, probably, something may still crash or be broken. Be helpful towards each other in the issues and when submitting PRs - and remember to follow the <a href="https://code.fb.com/codeofconduct/">CoC</a> enforced: there's always a human on the other side of the screen.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/06/14/state-of-react-native-2018">State of React Native 2018</a></h1><p class="post-meta">June 14, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://github.com/sophiebits" target="_blank" rel="noreferrer noopener">Sophie Alpert</a>Engineering Manager on React at Facebook</p><div class="authorPhoto authorPhotoBig"><a href="https://github.com/sophiebits" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/6820?s=460&amp;v=4" alt="Sophie Alpert"/></a></div></div></header><article class="post-content"><div><span><p>It's been a while since we last published a status update about React Native.</p>
<p>At Facebook, we're using React Native more than ever and for many important projects. One of our most popular products is Marketplace, one of the top-level tabs in our app which is used by 800 million people each month. Since its creation in 2015, all of Marketplace has been built with React Native, including over a hundred full-screen views throughout different parts of the app.</p>
<p>We're also using React Native for many new parts of the app. If you watched the F8 keynote last month, you'll recognize Blood Donations, Crisis Response, Privacy Shortcuts, and Wellness Checks – all recent features built with React Native. And projects outside the main Facebook app are using React Native too. The new Oculus Go VR headset includes <a href="https://www.oculus.com/app/">a companion mobile app</a> that is fully built with React Native, not to mention React VR powering many experiences in the headset itself.</p>
<p>Naturally, we also use many other technologies to build our apps. <a href="https://fblitho.com/">Litho</a> and <a href="https://componentkit.org/">ComponentKit</a> are two libraries we use extensively in our apps; both provide a React-like component API for building native screens. It's never been a goal for React Native to replace all other technologies – we are focused on making React Native itself better, but we love seeing other teams borrow ideas from React Native, like bringing <a href="https://instagram-engineering.com/instant-feedback-in-ios-engineering-workflows-c3f6508c76c8">instant reload</a> to non-JavaScript code too.</p>
<h2><a class="anchor" aria-hidden="true" id="architecture"></a><a href="#architecture" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Architecture</h2>
<p>When we started the React Native project in 2013, we designed it to have a single “bridge” between JavaScript and native that is asynchronous, serializable, and batched. Just as React DOM turns React state updates into imperative, mutative calls to DOM APIs like <code>document.createElement(attrs)</code> and <code>.appendChild()</code>, React Native was designed to return a single JSON message that lists mutations to perform, like <code>[[&quot;createView&quot;, attrs], [&quot;manageChildren&quot;, ...]]</code>. We designed the entire system to never rely on getting a synchronous response back and to ensure everything in that list could be fully serialized to JSON and back. We did this for the flexibility it gave us: on top of this architecture, we were able to build tools like <a href="/docs/debugging.html#chrome-developer-tools">Chrome debugging</a>, which runs all the JavaScript code asynchronously over a WebSocket connection.</p>
<p>Over the last 5 years, we found that these initial principles have made building some features harder. An asynchronous bridge means you can't integrate JavaScript logic directly with many native APIs expecting synchronous answers. A batched bridge that queues native calls means it's harder to have React Native apps call into functions that are implemented natively. And a serializable bridge means unnecessary copying instead of directly sharing memory between the two worlds. For apps that are entirely built in React Native, these restrictions are usually bearable. But for apps with complex integration between React Native and existing app code, they are frustrating.</p>
<p><strong>We're working on a large-scale rearchitecture of React Native to make the framework more flexible and integrate better with native infrastructure in hybrid JavaScript/native apps.</strong> With this project, we'll apply what we've learned over the last 5 years and incrementally bring our architecture to a more modern one. We're rewriting many of React Native's internals, but most of the changes are under the hood: existing React Native apps will continue to work with few or no changes.</p>
<p>To make React Native more lightweight and fit better into existing native apps, this rearchitecture has three major internal changes. First, we are changing the threading model. Instead of each UI update needing to perform work on three different threads, it will be possible to call synchronously into JavaScript on any thread for high-priority updates while still keeping low-priority work off the main thread to maintain responsiveness. Second, we are incorporating <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">async rendering</a> capabilities into React Native to allow multiple rendering priorities and to simplify asynchronous data handling. Finally, we are simplifying our bridge to make it faster and more lightweight; direct calls between native and JavaScript are more efficient and will make it easier to build debugging tools like cross-language stack traces.</p>
<p>Once these changes are completed, closer integrations will be possible. Today, it's not possible to incorporate native navigation and gesture handling or native components like UICollectionView and RecyclerView without complex hacks. After our changes to the threading model, building features like this will be straightforward.</p>
<p>We'll release more details about this work later this year as it approaches completion.</p>
<h2><a class="anchor" aria-hidden="true" id="community"></a><a href="#community" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Community</h2>
<p>Alongside the community inside Facebook, we're happy to have a thriving population of React Native users and collaborators outside Facebook. We'd like to support the React Native community more, both by serving React Native users better and by making the project easier to contribute to.</p>
<p>Just as our architecture changes will help React Native interoperate more cleanly with other native infrastructure, React Native should be slimmer on the JavaScript side to fit better with the JavaScript ecosystem, which includes making the VM and bundler swappable. We know the pace of breaking changes can be hard to keep up with, so we'd like to find ways to have fewer major releases. Finally, we know that some teams are looking for more thorough documentation in topics like startup optimization, where our expertise hasn't yet been written down. Expect to see some of these changes over the coming year.</p>
<p>If you're using React Native, you're part of our community; keep letting us know how we can make React Native better for you.</p>
<p>React Native is just one tool in a mobile developer's toolbox, but it's one that we strongly believe in – and we're making it better every day, with over 2500 commits in the last year from 500+ contributors.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/05/07/using-typescript-with-react-native">Using TypeScript with React Native</a></h1><p class="post-meta">May 7, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://github.com/ashfurrow" target="_blank" rel="noreferrer noopener">Ash Furrow</a>Software Engineer at Artsy</p><div class="authorPhoto authorPhotoBig"><a href="https://github.com/ashfurrow" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/498212?s=460&amp;v=4" alt="Ash Furrow"/></a></div></div></header><article class="post-content"><div><span><p>JavaScript! We all love it. But some of us also love <a href="https://en.wikipedia.org/wiki/Data_type">types</a>. Luckily, options exist to add stronger types to JavaScript. My favourite is <a href="https://www.typescriptlang.org">TypeScript</a>, but React Native supports <a href="https://flow.org">Flow</a> out of the box. Which you prefer is a matter of preference, they each have their own approach on how to add the magic of types to JavaScript. Today, we're going to look at how to use TypeScript in React Native apps.</p>
<p>This post uses Microsoft's <a href="https://github.com/Microsoft/TypeScript-React-Native-Starter">TypeScript-React-Native-Starter</a> repo as a guide.</p>
<p><strong>Update</strong>: Since this blog post was written, <a href="https://blogs.msdn.microsoft.com/typescript/2018/08/27/typescript-and-babel-7/">Babel 7 was released with integrated TypeScript support</a>. Babel 7 replaces all the set up described in this blog post with just one command:</p>
<pre><code class="hljs css language-sh">react-native init MyAwesomeProject --template typescript
</code></pre>
<p>However, there <em>are</em> some limitations to Babel's TypeScript support, which the blog post above goes into in detail. The steps outlined in <em>this</em> post still work, and Artsy is still using <a href="https://github.com/ds300/react-native-typescript-transformer">react-native-typescript-transformer</a> in production, but the fastest way to get up and running with React Native and TypeScript is using the above command. You can always switch later if you have to.</p>
<p>In any case, have fun! The original blog post continues below.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<p>Because you might be developing on one of several different platforms, targeting several different types of devices, basic setup can be involved. You should first ensure that you can run a plain React Native app without TypeScript. Follow <a href="/docs/getting-started.html">the instructions on the React Native website to get started</a>. When you've managed to deploy to a device or emulator, you'll be ready to start a TypeScript React Native app.</p>
<p>You will also need <a href="https://nodejs.org/en/">Node.js</a>, <a href="https://www.npmjs.com">npm</a>, and <a href="https://yarnpkg.com/lang/en">Yarn</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="initializing"></a><a href="#initializing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initializing</h2>
<p>Once you've tried scaffolding out an ordinary React Native project, you'll be ready to start adding TypeScript. Let's go ahead and do that.</p>
<pre><code class="hljs css language-sh">react-native init MyAwesomeProject
<span class="token builtin class-name">cd</span> MyAwesomeProject
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="adding-typescript"></a><a href="#adding-typescript" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding TypeScript</h2>
<p>The next step is to add TypeScript to your project. The following commands will:</p>
<ul>
<li>add TypeScript to your project</li>
<li>add <a href="https://github.com/ds300/react-native-typescript-transformer">React Native TypeScript Transformer</a> to your project</li>
<li>initialize an empty TypeScript config file, which we'll configure next</li>
<li>add an empty React Native TypeScript Transformer config file, which we'll configure next</li>
<li>adds <a href="https://github.com/DefinitelyTyped/DefinitelyTyped">typings</a> for React and React Native</li>
</ul>
<p>Okay, let's go ahead and run these.</p>
<pre><code class="hljs css language-sh"><span class="token function">yarn</span> <span class="token function">add</span> --dev typescript
<span class="token function">yarn</span> <span class="token function">add</span> --dev react-native-typescript-transformer
<span class="token function">yarn</span> tsc --init --pretty --jsx react
<span class="token function">touch</span> rn-cli.config.js
<span class="token function">yarn</span> <span class="token function">add</span> --dev @types/react @types/react-native
</code></pre>
<p>The <code>tsconfig.json</code> file contains all the settings for the TypeScript compiler. The defaults created by the command above are mostly fine, but open the file and uncomment the following line:</p>
<pre><code class="hljs css language-js"><span class="token punctuation">{</span>
  <span class="token comment">/* Search the config file for the following line and uncomment it. */</span>
  <span class="token comment">// "allowSyntheticDefaultImports": true,  /* Allow default imports from modules with no default export. This does not affect code emit, just typechecking. */</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>rn-cli.config.js</code> contains the settings for the React Native TypeScript Transformer. Open it and add the following:</p>
<pre><code class="hljs css language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getTransformModulePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'react-native-typescript-transformer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getSourceExts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'ts'</span><span class="token punctuation">,</span> <span class="token string">'tsx'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="migrating-to-typescript"></a><a href="#migrating-to-typescript" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Migrating to TypeScript</h2>
<p>Rename the generated <code>App.js</code> and <code>__tests_/App.js</code> files to <code>App.tsx</code>. <code>index.js</code> needs to use the <code>.js</code> extension. All new files should use the <code>.tsx</code> extension (or <code>.ts</code> if the file doesn't contain any JSX).</p>
<p>If you tried to run the app now, you'd get an error like <code>object prototype may only be an object or null</code>. This is caused by a failure to import the default export from React as well as a named export on the same line. Open <code>App.tsx</code> and modify the import at the top of the file:</p>
<pre><code class="hljs css language-diff"><span class="hljs-deletion">-import React, { Component } from 'react';</span>
<span class="hljs-addition">+import React from 'react'</span>
<span class="hljs-addition">+import { Component } from 'react';</span>
</code></pre>
<p>Some of this has to do with differences in how Babel and TypeScript interoperate with CommonJS modules. In the future, the two will stabilize on the same behaviour.</p>
<p>At this point, you should be able to run the React Native app.</p>
<h2><a class="anchor" aria-hidden="true" id="adding-typescript-testing-infrastructure"></a><a href="#adding-typescript-testing-infrastructure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding TypeScript Testing Infrastructure</h2>
<p>React Native ships with <a href="https://github.com/facebook/jest">Jest</a>, so for testing a React Native app with TypeScript, we'll want to add <a href="https://www.npmjs.com/package/ts-jest">ts-jest</a> to our <code>devDependencies</code>.</p>
<pre><code class="hljs css language-sh"><span class="token function">yarn</span> <span class="token function">add</span> --dev ts-jest
</code></pre>
<p>Then, we'll open up our <code>package.json</code> and replace the <code>jest</code> field with the following:</p>
<pre><code class="hljs css language-js"><span class="token punctuation">{</span>
  <span class="token string">"jest"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"preset"</span><span class="token punctuation">:</span> <span class="token string">"react-native"</span><span class="token punctuation">,</span>
    <span class="token string">"moduleFileExtensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"ts"</span><span class="token punctuation">,</span>
      <span class="token string">"tsx"</span><span class="token punctuation">,</span>
      <span class="token string">"js"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"transform"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"^.+\\.(js)$"</span><span class="token punctuation">:</span> <span class="token string">"&lt;rootDir>/node_modules/babel-jest"</span><span class="token punctuation">,</span>
      <span class="token string">"\\.(ts|tsx)$"</span><span class="token punctuation">:</span> <span class="token string">"&lt;rootDir>/node_modules/ts-jest/preprocessor.js"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"testRegex"</span><span class="token punctuation">:</span> <span class="token string">"(/__tests__/.*|\\.(test|spec))\\.(ts|tsx|js)$"</span><span class="token punctuation">,</span>
    <span class="token string">"testPathIgnorePatterns"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"\\.snap$"</span><span class="token punctuation">,</span>
      <span class="token string">"&lt;rootDir>/node_modules/"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"cacheDirectory"</span><span class="token punctuation">:</span> <span class="token string">".jest/cache"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This will configure Jest to run <code>.ts</code> and <code>.tsx</code> files with <code>ts-jest</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="installing-dependency-type-declarations"></a><a href="#installing-dependency-type-declarations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installing Dependency Type Declarations</h2>
<p>To get the best experience in TypeScript, we want the type-checker to understand the shape and API of our dependencies. Some libraries will publish their packages with <code>.d.ts</code> files (type declaration/type definition files), which can describe the shape of the underlying JavaScript. For other libraries, we'll need to explicitly install the appropriate package in the <code>@types/</code> npm scope.</p>
<p>For example, here we'll need types for Jest, React, and React Native, and React Test Renderer.</p>
<pre><code class="hljs css language-ts">yarn add --dev <span class="hljs-meta">@types</span>/jest <span class="hljs-meta">@types</span>/react <span class="hljs-meta">@types</span>/react-native <span class="hljs-meta">@types</span>/react-test-renderer
</code></pre>
<p>We saved these declaration file packages to our <em>dev</em> dependencies because this is a React Native <em>app</em> that only uses these dependencies during development and not during runtime. If we were publishing a library to NPM, we might have to add some of these type dependencies as regular dependencies.</p>
<p>You can read more <a href="https://www.typescriptlang.org/docs/handbook/declaration-files/consumption.html">here about getting <code>.d.ts</code> files</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="ignoring-more-files"></a><a href="#ignoring-more-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ignoring More Files</h2>
<p>For your source control, you'll want to start ignoring the <code>.jest</code> folder. If you're using git, we can just add entries to our <code>.gitignore</code> file.</p>
<pre><code class="hljs css language-config"><span class="hljs-meta"># Jest</span>
<span class="hljs-meta">#</span>
.jest/
</code></pre>
<p>As a checkpoint, consider committing your files into version control.</p>
<pre><code class="hljs css language-sh"><span class="token function">git</span> init
<span class="token function">git</span> <span class="token function">add</span> .gitignore <span class="token comment"># import to do this first, to ignore our files</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit -am <span class="token string">"Initial commit."</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="adding-a-component"></a><a href="#adding-a-component" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding a Component</h2>
<p>Let's add a component to our app. Let's go ahead and create a <code>Hello.tsx</code> component. It's a pedagogical component, not something that you'd actually write in an app, but something nontrivial that shows off how to use TypeScript in React Native.</p>
<p>Create a <code>components</code> directory and add the following example.</p>
<pre><code class="hljs css language-ts">// components/Hello.tsx
import React from 'react';
import { Button, StyleSheet, Text, View } from 'react-native';

export interface Props {
  name: string;
  enthusiasmLevel?: number;
}

interface State {
  enthusiasmLevel: number;
}

export class Hello extends React.Component&lt;Props, State&gt; {
  constructor(props: Props) {
    super(props);

    if ((props.enthusiasmLevel || 0) &lt;= 0) {
      throw new Error(
        'You could be a little more enthusiastic. :D'
      );
    }

    this.state = {
      enthusiasmLevel: props.enthusiasmLevel || 1
    };
  }

  onIncrement = () =&gt;
    this.setState({
      enthusiasmLevel: this.state.enthusiasmLevel + 1
    });
  onDecrement = () =&gt;
    this.setState({
      enthusiasmLevel: this.state.enthusiasmLevel - 1
    });
  getExclamationMarks = (numChars: number) =&gt;
    Array(numChars + 1).join('!');

  render() {
    return (
      &lt;View style={styles.root}&gt;
        &lt;Text style={styles.greeting}&gt;
          Hello{' '}
          {this.props.name +
            this.getExclamationMarks(this.state.enthusiasmLevel)}
        &lt;/Text&gt;

        &lt;View style={styles.buttons}&gt;
          &lt;View style={styles.button}&gt;
            &lt;Button
              title="-"
              onPress={this.onDecrement}
              accessibilityLabel="decrement"
              color="red"
            /&gt;
          &lt;/View&gt;

          &lt;View style={styles.button}&gt;
            &lt;Button
              title="+"
              onPress={this.onIncrement}
              accessibilityLabel="increment"
              color="blue"
            /&gt;
          &lt;/View&gt;
        &lt;/View&gt;
      &lt;/View&gt;
    );
  }
}

// styles
const styles = StyleSheet.create({
  root: {
    alignItems: 'center',
    alignSelf: 'center'
  },
  buttons: {
    flexDirection: 'row',
    minHeight: 70,
    alignItems: 'stretch',
    alignSelf: 'center',
    borderWidth: 5
  },
  button: {
    flex: 1,
    paddingVertical: 0
  },
  greeting: {
    color: '#999',
    fontWeight: 'bold'
  }
});
</code></pre>
<p>Whoa! That's a lot, but let's break it down:</p>
<ul>
<li>Instead of rendering HTML elements like <code>div</code>, <code>span</code>, <code>h1</code>, etc., we're rendering components like <code>View</code> and <code>Button</code>. These are native components that work across different platforms.</li>
<li>Styling is specified using the <code>StyleSheet.create</code> function that React Native gives us. React's stylesheets allow us to control our layout using Flexbox, and style using other constructs similar to those in CSS.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="adding-a-component-test"></a><a href="#adding-a-component-test" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding a Component Test</h2>
<p>Now that we've got a component, let's try testing it.</p>
<p>We already have Jest installed as a test runner. We're going to write snapshot tests for our components, let's add the required add-on for snapshot tests:</p>
<pre><code class="hljs css language-sh"><span class="token function">yarn</span> <span class="token function">add</span> --dev react-addons-test-utils
</code></pre>
<p>Now let's create a <code>__tests__</code> folder in the <code>components</code> directory and add a test for <code>Hello.tsx</code>:</p>
<pre><code class="hljs css language-ts"><span class="hljs-comment">// components/__tests__/Hello.tsx</span>
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> renderer <span class="hljs-keyword">from</span> <span class="hljs-string">'react-test-renderer'</span>;

<span class="hljs-keyword">import</span> { Hello } <span class="hljs-keyword">from</span> <span class="hljs-string">'../Hello'</span>;

it(<span class="hljs-string">'renders correctly with defaults'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> button = renderer
    .create(&lt;Hello name=<span class="hljs-string">"World"</span> enthusiasmLevel={<span class="hljs-number">1</span>} /&gt;)
    .toJSON();
  expect(button).toMatchSnapshot();
});
</code></pre>
<p>The first time the test is run, it will create a snapshot of the rendered component and store it in the <code>components/__tests__/__snapshots__/Hello.tsx.snap</code> file. When you modify your component, you'll need to update the snapshots and review the update for inadvertent changes. You can read more about testing React Native components <a href="https://facebook.github.io/jest/docs/en/tutorial-react-native.html">here</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="next-steps"></a><a href="#next-steps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Next Steps</h2>
<p>Check out the official <a href="https://reactjs.org/tutorial/tutorial.html">React tutorial</a> and state-management library <a href="http://redux.js.org">Redux</a>. These resources can be helpful when writing React Native apps. Additionally, you may want to look at <a href="https://microsoft.github.io/reactxp/">ReactXP</a>, a component library written entirely in TypeScript that supports both React on the web as well as React Native.</p>
<p>Have fun in a more type-safe React Native development environment!</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/04/09/build-com-app">Built with React Native - The Build.com app</a></h1><p class="post-meta">April 9, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/gwmccull" target="_blank" rel="noreferrer noopener">Garrett McCullough</a>Senior Mobile Engineer</p><div class="authorPhoto authorPhotoBig"><a href="https://twitter.com/gwmccull" target="_blank" rel="noreferrer noopener"><img src="https://pbs.twimg.com/profile_images/955503100785172486/UrMKkQXc_400x400.jpg" alt="Garrett McCullough"/></a></div></div></header><article class="post-content"><div><span><p><a href="https://www.build.com/">Build.com</a>, headquartered in Chico, California, is one of the largest online retailers for home improvement items. The team has had a strong web-centric business for 18 years and began thinking about a mobile App in 2015. Building unique Android and iOS apps wasn’t practical due to our small team and limited native experience. Instead, we decided to take a risk on the very new React Native framework. Our initial commit was on August 12, 2015 using React Native v0.8.0! We were live in both App Stores on October 15, 2016. Over the last two years, we’ve continued to upgrade and expand the app. We are currently on React Native version 0.53.0.</p>
<p>You can check out the app at <a href="https://www.build.com/app">https://www.build.com/app</a>.</p>
<p align="center">
  <img src="/blog/assets/build-com-blog-image.jpg" />
</p>
<h2><a class="anchor" aria-hidden="true" id="features"></a><a href="#features" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Features</h2>
<p>Our app is full featured and includes everything that you’d expect from an e-commerce app: product listings, search and sorting, the ability to configure complex products, favorites, etc. We accept standard credit card payment methods as well as PayPal, and Apple Pay for our iOS users.</p>
<p>A few standout features you might not expect include:</p>
<ol>
<li>3D models available for around 40 products with 90 finishes</li>
<li>Augmented Reality (AR) to allow the user to see how lights and faucets will look in their home at 98% size accuracy. The Build.com React Native App is featured in the Apple App store for AR Shopping! AR is now available for Android and iOS!</li>
<li>Collaborative project management features that allow people to put together shopping lists for the different phases of their project and collaborate around selection</li>
</ol>
<p>We’re working on many new and exciting features that will continue to improve our app experience including the next phase of Immersive Shopping with AR.</p>
<h2><a class="anchor" aria-hidden="true" id="our-development-workflow"></a><a href="#our-development-workflow" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Our Development Workflow</h2>
<p>Build.com allows each dev to choose the tools that best suit them.</p>
<ul>
<li>IDEs include Atom, IntelliJ, VS Code, Sublime, Eclipse, etc.</li>
<li>For Unit testing, developers are responsible for creating Jest unit tests for any new components and we’re working to increase the coverage of older parts of the app using <code>jest-coverage-ratchet</code>.</li>
<li>We use Jenkins to build out our beta and release candidates. This process works well for us but still requires significant work to create the release notes and other artifacts.</li>
<li>Integration Testing include a shared pool of testers that work across desktop, mobile and web. Our automation engineer is building out our suite of automated integration tests using Java and Appium.</li>
<li>Other parts of the workflow include a detailed eslint configuration, custom rules that enforce properties needed for testing, and pre-push hooks that block offending changes.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="libraries-used-in-the-app"></a><a href="#libraries-used-in-the-app" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Libraries Used in the App</h2>
<p>The Build.com app relies on a number of common open source libraries including: Redux, Moment, Numeral, Enzyme and a bunch of React Native bridge modules. We also use a number of forked open source libraries; forked either because they were abandoned or because we needed custom features. A quick count shows around 115 JavaScript and native dependencies. We would like to explore tools that remove unused libraries.</p>
<p>We're in the process of adding static typing via TypeScript and looking into optional chaining. These features could help us with solving a couple classes of bugs that we still see:</p>
<ul>
<li>Data that is the wrong type</li>
<li>Data that is undefined because an object didn’t contain what we expected</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="open-source-contributions"></a><a href="#open-source-contributions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Open Source Contributions</h2>
<p>Since we rely so heavily on open source, our team is committed to contributing back to the community. Build.com allows the team to open source libraries that we've built and encourages us contribute back to the libraries that we use.</p>
<p>We’ve released and maintained a number of React Native libraries:</p>
<ul>
<li><code>react-native-polyfill</code></li>
<li><code>react-native-simple-store</code></li>
<li><code>react-native-contact-picker</code></li>
</ul>
<p>We have also contributed to a long list of libraries including: React and React Native, <code>react-native-schemes-manager</code>, <code>react-native-swipeable</code>, <code>react-native-gallery</code>, <code>react-native-view-transformer</code>, <code>react-native-navigation</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="our-journey"></a><a href="#our-journey" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Our Journey</h2>
<p>We’ve seen a lot of growth in React Native and the ecosystem in the past couple years. Early on, it seemed that every version of React Native would fix some bugs but introduce several more. For example, Remote JS Debugging was broken on Android for several months. Thankfully, things became much more stable in 2017.</p>
<h3><a class="anchor" aria-hidden="true" id="navigation-libraries"></a><a href="#navigation-libraries" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Navigation Libraries</h3>
<p>One of our big recurring challenges has been with navigation libraries. For a long time, we were using Expo’s ex-nav library. It worked well for us but it was eventually deprecated. However, we were in heavy feature development at the time so taking time to change out a navigation library wasn’t feasible. That meant we had to fork the library and patch it to support React 16 and the iPhone X. Eventually, we were able to migrate to <a href="https://github.com/wix/react-native-navigation"><code>react-native-navigation</code></a> and hopefully that will see continued support.</p>
<h3><a class="anchor" aria-hidden="true" id="bridge-modules"></a><a href="#bridge-modules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bridge Modules</h3>
<p>Another big challenge has been with bridge modules. When we first started, a lot of critical bridges were missing. One of my teammates wrote <code>react-native-contact-picker</code> because we needed access to the Android contact picker in our app. We’ve also seen a lot of bridges that were broken by changes within React Native. For example, there was a breaking change within React Native v40 and when we upgraded our app, I had to submit PRs to fix 3 or 4 libraries that had not yet been updated.</p>
<h2><a class="anchor" aria-hidden="true" id="looking-forward"></a><a href="#looking-forward" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Looking Forward</h2>
<p>As React Native continues to grow, our wishlist to our community include:</p>
<ul>
<li>Stabilize and improve the navigation libraries</li>
<li>Maintain support for libraries in the React Native ecosystem</li>
<li>Improve the experience for adding native libraries and bridge modules to a project</li>
</ul>
<p>Companies and individuals in the React Native community have been great about volunteering their time and effort to improve the tools that we all use. If you haven’t gotten involved in open source, I hope you’ll take a look at improving the code or documentation for some of the libraries that you use. There are a lot of articles to help you get started and it may be a lot easier than you think!</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/03/22/building-input-accessory-view-for-react-native">Building &lt;InputAccessoryView&gt; For React Native</a></h1><p class="post-meta">March 22, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://github.com/PeteTheHeat" target="_blank" rel="noreferrer noopener">Peter Argany</a>Software Engineer at Facebook</p><div class="authorPhoto authorPhotoBig"><a href="https://github.com/PeteTheHeat" target="_blank" rel="noreferrer noopener"><img src="https://avatars3.githubusercontent.com/u/6011080?s=400&amp;u=028e28081107d0ab16a5cb22baca43c080f5fa50&amp;v=4" alt="Peter Argany"/></a></div></div></header><article class="post-content"><div><span><h2><a class="anchor" aria-hidden="true" id="motivation"></a><a href="#motivation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Motivation</h2>
<p>Three years ago, a GitHub issue was opened to support input accessory view from React Native.</p>
<p><img src="/blog/assets/input-accessory-1.png"/></p>
<p>In the ensuing years, there have been countless '+1s', various workarounds, and zero concrete changes to RN on this issue - until today. Starting with iOS, <a href="/docs/inputaccessoryview">we're exposing an API</a> for accessing the native input accessory view and we are excited to share how we built it.</p>
<h2><a class="anchor" aria-hidden="true" id="background"></a><a href="#background" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Background</h2>
<p>What exactly is an input accessory view? Reading <a href="https://developer.apple.com/documentation/uikit/uiresponder/1621119-inputaccessoryview?language=objc">Apple's developer documentation</a>, we learn that it's a custom view which can be anchored to the top of the system keyboard whenever a receiver becomes the first responder. Anything that inherits from <code>UIResponder</code> can redeclare the <code>.inputAccessoryView</code> property as read-write, and manage a custom view here. The responder infrastructure mounts the view, and keeps it in sync with the system keyboard. Gestures which dismiss the keyboard, like a drag or tap, are applied to the input accessory view at the framework level. This allows us to build content with interactive keyboard dismissal, an integral feature in top-tier messaging apps like iMessage and WhatsApp.</p>
<p>There are two common use cases for anchoring a view to the top of the keyboard. The first is creating a keyboard toolbar, like the Facebook composer background picker.</p>
<p><img src="/blog/assets/input-accessory-2.gif" style="float:left; padding-right: 70px; padding-top: 20px"/></p>
<p>In this scenario, the keyboard is focused on a text input field, and the input accessory view is used to provide additional keyboard functionality. This functionality is contextual to the type of input field. In a mapping application it could be address suggestions, or in a text editor, it could be rich text formatting tools.</p>
<hr style="clear: both; margin-bottom: 20px"/>
<p>The Objective-C UIResponder who owns the <code>&lt;InputAccessoryView&gt;</code> in this scenario should be clear. The <code>&lt;TextInput&gt;</code> has become first responder, and under the hood this becomes an instance of <code>UITextView</code> or <code>UITextField</code>.</p>
<p>The second common scenario is sticky text inputs:</p>
<p><img src="/blog/assets/input-accessory-3.gif" style="float:left; padding-right: 70px; padding-top: 20px"/></p>
<p>Here, the text input is actually part of the input accessory view itself. This is commonly used in messaging applications, where a message can be composed while scrolling through a thread of previous messages.</p>
<hr style="clear: both; margin-bottom: 20px"/>
<p>Who owns the <code>&lt;InputAccessoryView&gt;</code> in this example? Can it be the <code>UITextView</code> or <code>UITextField</code> again? The text input is <em>inside</em> the input accessory view, this sounds like a circular dependency. Solving this issue alone is <a href="http://derpturkey.com/uitextfield-docked-like-ios-messenger/">another blog post</a> in itself. Spoilers: the owner is a generic <code>UIView</code> subclass who we manually tell to <a href="https://developer.apple.com/documentation/uikit/uiresponder/1621113-becomefirstresponder?language=objc">becomeFirstResponder</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="api-design"></a><a href="#api-design" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Design</h2>
<p>We now know what an <code>&lt;InputAccessoryView&gt;</code> is, and how we want to use it. The next step is designing an API that makes sense for both use cases, and works well with existing React Native components like <code>&lt;TextInput&gt;</code>.</p>
<p>For keyboard toolbars, there are a few things we want to consider:</p>
<ol>
<li>We want to be able to hoist any generic React Native view hierarchy into the <code>&lt;InputAccessoryView&gt;</code>.</li>
<li>We want this generic and detached view hierarchy to accept touches and be able to manipulate application state.</li>
<li>We want to link an <code>&lt;InputAccessoryView&gt;</code> to a particular <code>&lt;TextInput&gt;</code>.</li>
<li>We want to be able to share an <code>&lt;InputAccessoryView&gt;</code> across multiple text inputs, without duplicating any code.</li>
</ol>
<p>We can achieve #1 using a concept similar to <a href="https://reactjs.org/docs/portals.html">React portals</a>. In this design, we portal React Native views to a <code>UIView</code> hierarchy managed by the responder infrastructure. Since React Native views render as UIViews, this is actually quite straightforward - we can just override:</p>
<p><code>- (void)insertReactSubview:(UIView *)subview atIndex:(NSInteger)atIndex</code></p>
<p>and pipe all the subviews to a new UIView hierarchy. For #2, we set up a new <a href="https://github.com/facebook/react-native/blob/master/React/Base/RCTTouchHandler.h">RCTTouchHandler</a> for the <code>&lt;InputAccessoryView&gt;</code>. State updates are achieved by using regular event callbacks. For #3 and #4, we use the <a href="https://github.com/facebook/react-native/blob/master/React/Views/UIView%2BReact.h#L28">nativeID</a> field to locate the accessory view UIView hierarchy in native code during the creation of a <code>&lt;TextInput&gt;</code> component. This function uses the <code>.inputAccessoryView</code> property of the underlying native text input. Doing this effectively links <code>&lt;InputAccessoryView&gt;</code> to <code>&lt;TextInput&gt;</code> in their ObjC implementations.</p>
<p>Supporting sticky text inputs (scenario 2) adds a few more constraints. For this design, the input accessory view has a text input as a child, so linking via nativeID is not an option. Instead, we set the <code>.inputAccessoryView</code> of a generic off-screen <code>UIView</code> to our native <code>&lt;InputAccessoryView&gt;</code> hierarchy. By manually telling this generic <code>UIView</code> to become first responder, the hierarchy is mounted by responder infrastructure. This concept is explained thoroughly in the aforementioned blog post.</p>
<h2><a class="anchor" aria-hidden="true" id="pitfalls"></a><a href="#pitfalls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pitfalls</h2>
<p>Of course not everything was smooth sailing while building this API. Here are a few pitfalls we encountered, along with how we fixed them.</p>
<p>An initial idea for building this API involved listening to <code>NSNotificationCenter</code> for UIKeyboardWill(Show/Hide/ChangeFrame) events. This pattern is used in some open-sourced libraries, and internally in some parts of the Facebook app. Unfortunately, <code>UIKeyboardDidChangeFrame</code> events were not being called in time to update the <code>&lt;InputAccessoryView&gt;</code> frame on swipes. Also, changes in keyboard height are not captured by these events. This creates a class of bugs that manifest like this:</p>
<p><img src="/blog/assets/input-accessory-4.gif" style="float:left; padding-right: 70px; padding-top: 20px"/></p>
<p>On iPhone X, text and emoji keyboard are different heights. Most applications using keyboard events to manipulate text input frames had to fix the above bug. Our solution was to commit to using the <code>.inputAccessoryView</code> property, which meant that the responder infrastructure handles frame updates like this.</p>
<hr style="clear: both; margin-bottom: 20px"/>
<p>Another tricky bug we encountered was avoiding the home pill on iPhone X. You may be thinking, “Apple developed <a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide?language=objc">safeAreaLayoutGuide</a> for this very reason, this is trivial!”. We were just as naive. The first issue is that the native <code>&lt;InputAccessoryView&gt;</code> implementation has no window to anchor to until the moment it is about to appear. That's alright, we can override <code>-(BOOL)becomeFirstResponder</code> and enforce layout constraints there. Adhering to these constraints bumps the accessory view up, but another bug arises:</p>
<p><img src="/blog/assets/input-accessory-5.gif" style="float:left; padding-right: 70px; padding-top: 20px"/></p>
<p>The input accessory view successfully avoids the home pill, but now content behind the unsafe area is visible. The solution lies in this <a href="http://www.openradar.me/34411433">radar</a>. I wrapped the native <code>&lt;InputAccessoryView&gt;</code> hierarchy in a container which doesn't conform to the <code>safeAreaLayoutGuide</code> constraints. The native container covers the content in the unsafe area, while the <code>&lt;InputAccessoryView&gt;</code> stays within the safe area boundaries.</p>
<hr style="clear: both; margin-bottom: 20px"/>
<h2><a class="anchor" aria-hidden="true" id="example-usage"></a><a href="#example-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example Usage</h2>
<p>Here's an example which builds a keyboard toolbar button to reset <code>&lt;TextInput&gt;</code> state.</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">class</span> <span class="token class-name">TextInputAccessoryViewExample</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">*</span>
<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> text<span class="token punctuation">:</span> <span class="token string">'Placeholder Text'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> inputAccessoryViewID <span class="token operator">=</span> <span class="token string">'inputAccessoryView1'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TextInput</span></span>
          <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>default<span class="token punctuation">}</span></span>
          <span class="token attr-name">inputAccessoryViewID</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputAccessoryViewID<span class="token punctuation">}</span></span>
          <span class="token attr-name">onChangeText</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">InputAccessoryView</span></span> <span class="token attr-name">nativeID</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputAccessoryViewID<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> backgroundColor<span class="token punctuation">:</span> <span class="token string">'white'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>
              <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token punctuation">:</span> <span class="token string">'Placeholder Text'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span></span>
              <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Reset Text<span class="token punctuation">"</span></span>
            <span class="token punctuation">/></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">InputAccessoryView</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Another example for <a href="https://github.com/facebook/react-native/blob/84ef7bc372ad870127b3e1fb8c13399fe09ecd4d/RNTester/js/InputAccessoryViewExample.js">Sticky Text Inputs can be found in the repository</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="when-will-i-be-able-to-use-this"></a><a href="#when-will-i-be-able-to-use-this" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When will I be able to use this?</h2>
<p>The full commit for this feature implementation is <a href="https://github.com/facebook/react-native/commit/38197c8230657d567170cdaf8ff4bbb4aee732b8">here</a>. <a href="http://reactnative.dev/docs/next/inputaccessoryview.html"><code>&lt;InputAccessoryView&gt;</code></a> will be available in the upcoming v0.55.0 release.</p>
<p>Happy keyboarding :)</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/03/05/AWS-app-sync">Using AWS with React Native</a></h1><p class="post-meta">March 5, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/undef_obj" target="_blank" rel="noreferrer noopener">Richard Threlkeld</a>Senior Technical Product Manager at AWS Mobile</p><div class="authorPhoto authorPhotoBig"><a href="https://twitter.com/undef_obj" target="_blank" rel="noreferrer noopener"><img src="https://pbs.twimg.com/profile_images/811239086581227520/APX1eZwF_400x400.jpg" alt="Richard Threlkeld"/></a></div></div></header><article class="post-content"><div><span><p>AWS is well known in the technology industry as a provider of cloud services. These include compute, storage, and database technologies, as well as fully managed serverless offerings. The AWS Mobile team has been working closely with customers and members of the JavaScript ecosystem to make cloud-connected mobile and web applications more secure, scalable, and easier to develop and deploy. We began with a <a href="https://github.com/awslabs/aws-mobile-react-native-starter">complete starter kit</a>, but have a few more recent developments.</p>
<p>This blog post talks about some interesting things for React and React Native developers:</p>
<ul>
<li><a href="https://github.com/aws/aws-amplify"><strong>AWS Amplify</strong></a>, a declarative library for JavaScript applications using cloud services</li>
<li><a href="https://aws.amazon.com/appsync/"><strong>AWS AppSync</strong></a>, a fully managed GraphQL service with offline and real-time features</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="aws-amplify"></a><a href="#aws-amplify" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS Amplify</h2>
<p>React Native applications are very easy to bootstrap using tools like Create React Native App and Expo. However, connecting them to the cloud can be challenging to navigate when you try to match a use case to infrastructure services. For example, your React Native app might need to upload photos. Should these be protected per user? That probably means you need some sort of registration or sign-in process. Do you want your own user directory or are you using a social media provider? Maybe your app also needs to call an API with custom business logic after users log in.</p>
<p>To help JavaScript developers with these problems, we released a library named AWS Amplify. The design is broken into &quot;categories&quot; of tasks, instead of AWS-specific implementations. For example, if you wanted users to register, log in, and then upload private photos, you would simply pull in <code>Auth</code> and <code>Storage</code> categories to your application:</p>
<pre><code class="hljs"><span class="hljs-keyword">import</span> { Auth } <span class="hljs-keyword">from</span> <span class="hljs-string">'aws-amplify'</span>;

Auth.signIn(username, password)
    .then(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(user))
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(err));

Auth.confirmSignIn(user, code)
    .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(data))
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(err));
</code></pre>
<p>In the code above, you can see an example of some of the common tasks that Amplify helps you with, such as using multi-factor authentication (MFA) codes with either email or SMS. The supported categories today are:</p>
<ul>
<li><strong>Auth</strong>: Provides credential automation. Out-of-the-box implementation uses AWS credentials for signing, and OIDC JWT tokens from <a href="https://aws.amazon.com/cognito/">Amazon Cognito</a>. Common functionality, such as MFA features, is supported.</li>
<li><strong>Analytics</strong>: With a single line of code, get tracking for authenticated or unauthenticated users in <a href="https://aws.amazon.com/pinpoint/">Amazon Pinpoint</a>. Extend this for custom metrics or attributes, as you prefer.</li>
<li><strong>API</strong>: Provides interaction with RESTful APIs in a secure manner, leveraging <a href="https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html">AWS Signature Version 4</a>. The API module is great on serverless infrastructures with <a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a>.</li>
<li><strong>Storage</strong>: Simplified commands to upload, download, and list content in <a href="https://aws.amazon.com/s3/">Amazon S3</a>. You can also easily group data into public or private content on a per-user basis.</li>
<li><strong>Caching</strong>: An LRU cache interface across web apps and React Native that uses implementation-specific persistence.</li>
<li><strong>i18n and Logging</strong>: Provides internationalization and localization capabilities, as well as debugging and logging capabilities.</li>
</ul>
<p>One of the nice things about Amplify is that it encodes &quot;best practices&quot; in the design for your specific programming environment. For example, one thing we found working with customers and React Native developers is that shortcuts taken during development to get things working quickly would make it through to production stacks. These can compromise either scalability or security, and force infrastructure rearchitecture and code refactoring.</p>
<p>One example of how we help developers avoid this is the <a href="https://www.allthingsdistributed.com/2016/06/aws-lambda-serverless-reference-architectures.html">Serverless Reference Architectures with AWS Lambda</a>. These show you best practices around using Amazon API Gateway and AWS Lambda together when building your backend. This pattern is encoded into the <code>API</code> category of Amplify. You can use this pattern to interact with several different REST endpoints, and pass headers all the way through to your Lambda function for custom business logic. We’ve also released an <a href="https://docs.aws.amazon.com/aws-mobile/latest/developerguide/react-native-getting-started.html">AWS Mobile CLI</a> for bootstrapping new or existing React Native projects with these features. To get started, just install via <strong>npm</strong>, and follow the configuration prompts:</p>
<pre><code class="hljs"><span class="hljs-built_in">npm</span> install --<span class="hljs-built_in">global</span> awsmobile-cli
awsmobile configure
</code></pre>
<p>Another example of encoded best practices that is specific to the mobile ecosystem is password security. The default <code>Auth</code> category implementation leverages Amazon Cognito user pools for user registration and sign-in. This service implements <a href="http://srp.stanford.edu">Secure Remote Password protocol</a> as a way of protecting users during authentication attempts. If you're inclined to read through the <a href="http://srp.stanford.edu/ndss.html#SECTION00032200000000000000">mathematics of the protocol</a>, you'll notice that you must use a large prime number when calculating the password verifier over a primitive root to generate a Group. In React Native environments, <a href="/docs/javascript-environment.html">JIT is disabled</a>. This makes BigInteger calculations for security operations such as this less performant. To account for this, we've released native bridges in Android and iOS that you can link inside your project:</p>
<pre><code class="hljs">npm <span class="hljs-keyword">install</span> <span class="hljs-comment">--save aws-amplify-react-native</span>
react-<span class="hljs-keyword">native</span> <span class="hljs-keyword">link</span> amazon-cognito-<span class="hljs-keyword">identity</span>-js
</code></pre>
<p>We're also excited to see that the Expo team has included this <a href="https://blog.expo.io/expo-sdk-v25-0-0-is-now-available-714d10a8c3f7">in their latest SDK</a> so that you can use Amplify without ejecting.</p>
<p>Finally, specific to React Native (and React) development, Amplify contains <a href="https://reactjs.org/docs/higher-order-components.html">higher order components (HOCs)</a> for easily wrapping functionality, such as for sign-up and sign-in to your app:</p>
<pre><code class="hljs">import Amplify, { withAuthenticator } <span class="hljs-keyword">from</span> <span class="hljs-string">'aws-amplify-react-native'</span>;
import aws_exports <span class="hljs-keyword">from</span> <span class="hljs-string">'./aws-exports'</span>;

Amplify.configure(aws_exports);

class App extends React.Component {
<span class="hljs-built_in">..</span>.
}

<span class="hljs-builtin-name">export</span><span class="hljs-built_in"> default </span>withAuthenticator(App);
</code></pre>
<p>The underlying component is also provided as <code>&lt;Authenticator /&gt;</code>, which gives you full control to customize the UI. It also gives you some properties around managing the state of the user, such as if they've signed in or are waiting for MFA confirmation, and callbacks that you can fire when state changes.</p>
<p>Similarly, you'll find general React components that you can use for different use cases. You can customize these to your needs, for example, to show all private images from Amazon S3 in the <code>Storage</code> module:</p>
<pre><code class="hljs">&lt;S3Album
  level=<span class="hljs-string">"private"</span>
 <span class="hljs-built_in"> path</span>=<span class="hljs-built_in">{path</span>}
 <span class="hljs-built_in"> filter</span>={(<span class="hljs-type">item</span>) =&gt; /jpg/i.test(<span class="hljs-type">item</span><span class="hljs-built_in">.path</span>)}/&gt;
</code></pre>
<p>You can control many of the component features via props, as shown earlier, with public or private storage options. There are even capabilities to automatically gather analytics when users interact with certain UI components:</p>
<pre><code class="hljs"><span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">S3Album</span> <span class="hljs-attr">track</span>/&gt;</span></span>
</code></pre>
<p>AWS Amplify favors a convention over configuration style of development, with a global initialization routine or initialization at the category level. The quickest way to get started is with an <a href="https://aws.amazon.com/blogs/mobile/enhanced-javascript-development-with-aws-mobile-hub/">aws-exports file</a>. However, developers can also use the library independently with existing resources.</p>
<p>For a deep dive into the philosophy and to see a full demo, check out the video from <a href="https://www.youtube.com/watch?v=vAjf3lyjf8c">AWS re:Invent</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="aws-appsync"></a><a href="#aws-appsync" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS AppSync</h2>
<p>Shortly after the launch of AWS Amplify, we also released <a href="https://aws.amazon.com/appsync/">AWS AppSync</a>. This is a fully managed GraphQL service that has both offline and real-time capabilities. Although you can use GraphQL in different client programming languages (including native Android and iOS), it's quite popular among React Native developers. This is because the data model fits nicely into a unidirectional data flow and component hierarchy.</p>
<p>AWS AppSync enables you to connect to resources in your own AWS account, meaning you own and control your data. This is done by using data sources, and the service supports <a href="https://aws.amazon.com/dynamodb/">Amazon DynamoDB</a>, <a href="https://aws.amazon.com/elasticsearch-service/">Amazon Elasticsearch</a>, and <a href="https://aws.amazon.com/lambda/">AWS Lambda</a>. This enables you to combine functionality (such as NoSQL and full-text search) in a single GraphQL API as a schema. This enables you to mix and match data sources. The AppSync service can also <a href="https://docs.aws.amazon.com/appsync/latest/devguide/provision-from-schema.html">provision from a schema</a>, so if you aren't familiar with AWS services, you can write GraphQL SDL, click a button, and you're automatically up and running.</p>
<p>The real-time functionality in AWS AppSync is controlled via <a href="http://graphql.org/blog/subscriptions-in-graphql-and-relay/">GraphQL subscriptions with a well-known, event-based pattern</a>. Because subscriptions in AWS AppSync are <a href="https://docs.aws.amazon.com/appsync/latest/devguide/real-time-data.html">controlled on the schema</a> with a GraphQL directive, and a schema can use any data source, this means you can trigger notifications from database operations with Amazon DynamoDB and Amazon Elasticsearch Service, or from other parts of your infrastructure with AWS Lambda.</p>
<p>In a way similar to AWS Amplify, you can use <a href="https://docs.aws.amazon.com/appsync/latest/devguide/security.html">enterprise security features</a> on your GraphQL API with AWS AppSync. The service lets you get started quickly with API keys. However, as you roll to production it can transition to using AWS Identity and Access Management (IAM) or OIDC tokens from Amazon Cognito user pools. You can control access at the resolver level with policies on types. You can even use logical checks for <a href="https://docs.aws.amazon.com/appsync/latest/devguide/security.html#fine-grained-access-control">fine-grained access control</a> checks at run time, such as detecting if a user is the owner of a specific database resource. There are also capabilities around checking group membership for executing resolvers or individual database record access.</p>
<p>To help React Native developers learn more about these technologies, there is a <a href="https://docs.aws.amazon.com/appsync/latest/devguide/quickstart.html">built-in GraphQL sample schema</a> that you can launch on the AWS AppSync console homepage. This sample deploys a GraphQL schema, provisions database tables, and connects queries, mutations, and subscriptions automatically for you. There is also a functioning <a href="https://github.com/aws-samples/aws-mobile-appsync-events-starter-react-native">React Native example for AWS AppSync</a> which leverages this built in schema (as well as a <a href="https://github.com/aws-samples/aws-mobile-appsync-events-starter-react">React example</a>), which enable you to get both your client and cloud components running in minutes.</p>
<p>Getting started is simple when you use the <code>AWSAppSyncClient</code>, which plugs in to the <a href="https://github.com/apollographql/apollo-client">Apollo Client</a>. The <code>AWSAppSyncClient</code> handles security and signing for your GraphQL API, offline functionality, and the subscription handshake and negotiation process:</p>
<pre><code class="hljs">import AWSAppSyncClient <span class="hljs-keyword">from</span> <span class="hljs-string">"aws-appsync"</span>;
import { Rehydrated } <span class="hljs-keyword">from</span> <span class="hljs-string">'aws-appsync-react'</span>;
import { AUTH_TYPE } <span class="hljs-keyword">from</span> <span class="hljs-string">"aws-appsync/lib/link/auth-link"</span>;

const<span class="hljs-built_in"> client </span>= new AWSAppSyncClient({
  url: awsconfig.graphqlEndpoint,
  region: awsconfig.region,
  auth: {type: AUTH_TYPE.API_KEY, apiKey: awsconfig.apiKey}
});
</code></pre>
<p>The AppSync console provides a configuration file for download, which contains your GraphQL endpoint, AWS Region, and API key. You can then use the client with <a href="https://github.com/apollographql/react-apollo">React Apollo</a>:</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span> WithProvider = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ApolloProvider</span> <span class="hljs-attr">client</span>=<span class="hljs-string">{client}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Rehydrated</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Rehydrated</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ApolloProvider</span>&gt;</span></span>
);
</code></pre>
<p>At this point, you can use standard GraphQL queries:</p>
<pre><code class="hljs">query ListEvents {
    listEvents{
      <span class="hljs-built_in">items</span>{
        <span class="hljs-variable">__typename</span>
        id
        <span class="hljs-built_in">name</span>
        where
        when
        description
        comments{
          <span class="hljs-variable">__typename</span>
          <span class="hljs-built_in">items</span>{
            <span class="hljs-variable">__typename</span>
            eventId
            commentId
            content
            createdAt
          }
          nextToken
        }
      }
    }
}
</code></pre>
<p>The example above shows a query with the sample app schema provisioned by AppSync. It not only showcases interaction with DynamoDB, but also includes pagination of data (including encrypted tokens) and type relations between <code>Events</code> and <code>Comments</code>. Because the app is configured with the <code>AWSAppSyncClient</code>, data is automatically persisted offline and will synchronize when devices reconnect.</p>
<p>You can see a deep dive of the <a href="https://www.youtube.com/watch?v=FtkVlIal_m0">client technology behind this and a React Native demo in this video</a>.</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/FtkVlIal_m0?rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
<h2><a class="anchor" aria-hidden="true" id="feedback"></a><a href="#feedback" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Feedback</h2>
<p>The team behind the libraries is eager to hear how these libraries and services work for you. They also want to hear what else we can do to make React and React Native development with cloud services easier for you. Reach out to the AWS Mobile team on GitHub for <a href="https://github.com/aws/aws-amplify">AWS Amplify</a> or <a href="https://github.com/aws-samples/aws-mobile-appsync-events-starter-react-native">AWS AppSync</a>.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/01/18/implementing-twitters-app-loading-animation-in-react-native">Implementing Twitter’s App Loading Animation in React Native</a></h1><p class="post-meta">January 18, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://github.com/TheSavior" target="_blank" rel="noreferrer noopener">Eli White</a>Software Engineer at Facebook</p><div class="authorPhoto authorPhotoBig"><a href="https://github.com/TheSavior" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/249164?s=460&amp;v=4" alt="Eli White"/></a></div></div></header><article class="post-content"><div><span><p>Twitter’s iOS app has a loading animation I quite enjoy.</p>
<p><img src="/blog/assets/loading-screen-01.gif" style="float: left; padding-right: 80px; padding-bottom: 20px"/></p>
<p>Once the app is ready, the Twitter logo delightfully expands, revealing the app.</p>
<p>I wanted to figure out how to recreate this loading animation with React Native.</p>
<hr style="clear: both; margin-bottom: 40px; width: 80px"/>
<p>To understand <em>how</em> to build it, I first had to understand the difference pieces of the loading animation. The easiest way to see the subtlety is to slow it down.</p>
<p><img src="/blog/assets/loading-screen-02.gif" style="margin-top: 20px; float: left; padding-right: 80px; padding-bottom: 20px"/></p>
<p>There are a few major pieces in this that we will need to figure out how to build.</p>
<ol>
<li>Scaling the bird.</li>
<li>As the bird grows, showing the app underneath</li>
<li>Scaling the app down slightly at the end</li>
</ol>
<p>It took me quite a while to figure out how to make this animation.</p>
<p>I started with an <em>incorrect</em> assumption that the blue background and Twitter bird were a layer on <em>top</em> of the app and that as the bird grew, it became transparent which revealed the app underneath. This approach doesn’t work because the Twitter bird becoming transparent would show the blue layer, not the app underneath!</p>
<p>Luckily for you, dear reader, you don’t have to go through the same frustration I did. You get this nice tutorial skipping to the good stuff!</p>
<hr style="clear: both; margin-bottom: 40px; width: 80px"/>
<h2><a class="anchor" aria-hidden="true" id="the-right-way"></a><a href="#the-right-way" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The right way</h2>
<p>Before we get to code, it is important to understand how to break this down. To help visualize this effect, I recreated it in <a href="https://codepen.io/TheSavior/pen/NXNoJM">CodePen</a> (embedded in a few paragraphs) so you can interactively see the different layers.</p>
<p><img src="/blog/assets/loading-screen-03.png" style="float: left; padding-right: 80px; padding-bottom: 20px"/></p>
<p>There are three main layers to this effect. The first is the blue background layer. Even though this seems to appear on top of the app, it is actually in the back.</p>
<p>We then have a plain white layer. And then lastly, in the very front, is our app.</p>
<hr style="clear: both; margin-bottom: 40px; width: 80px"/>
<p><img src="/blog/assets/loading-screen-04.png" style="float: left; padding-right: 80px; padding-bottom: 20px"/></p>
<p>The main trick to this animation is using the Twitter logo as a <code>mask</code> and masking both the app, and the white layer. I won’t go too deep on the details of masking, there are <a href="https://www.html5rocks.com/en/tutorials/masking/adobe/">plenty</a> of <a href="https://designshack.net/articles/graphics/a-complete-beginners-guide-to-masking-in-photoshop/">resources</a> <a href="https://www.sketchapp.com/docs/shapes/masking/">online</a> for that.</p>
<p>The basics of masking in this context are having images where opaque pixels of the mask show the content they are masking whereas transparent pixels of the mask hide the content they are masking.</p>
<p>We use the Twitter logo as a mask, and having it mask two layers; the solid white layer, and the app layer.</p>
<p>To reveal the app, we scale the mask up until it is larger than the entire screen.</p>
<p>While the mask is scaling up, we fade in the opacity of the app layer, showing the app and hiding the solid white layer behind it. To finish the effect, we start the app layer at a scale &gt; 1, and scale it down to 1 as the animation is ending. We then hide the non-app layers as they will never be seen again.</p>
<p>They say a picture is worth 1,000 words. How many words is an interactive visualization worth? Click through the animation with the “Next Step” button. Showing the layers gives you a side view perspective. The grid is there to help visualize the transparent layers.</p>
<iframe height='750' scrolling='no' title='Loading Screen Animation Steps' src='//codepen.io/TheSavior/embed/NXNoJM/?height=265&theme-id=0&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' class='codepen'>See the Pen <a href='https://codepen.io/TheSavior/pen/NXNoJM/'>Loading Screen Animation Steps</a> by Eli White (<a href='https://codepen.io/TheSavior'>@TheSavior</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>
<h2><a class="anchor" aria-hidden="true" id="now-for-the-react-native"></a><a href="#now-for-the-react-native" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Now, for the React Native</h2>
<p>Alrighty. Now that we know what we are building and how the animation works, we can get down to the code — the reason you are really here.</p>
<p>The main piece of this puzzle is <a href="/docs/maskedviewios.html">MaskedViewIOS</a>, a core React Native component.</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> MaskedViewIOS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native'</span><span class="token punctuation">;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MaskedViewIOS</span></span> <span class="token attr-name">maskElement</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span><span class="token punctuation">></span></span><span class="token plain-text">Basic Mask</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">></span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> backgroundColor<span class="token punctuation">:</span> <span class="token string">'blue'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MaskedViewIOS</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
</code></pre>
<p><code>MaskedViewIOS</code> takes props <code>maskElement</code> and <code>children</code>. The children are masked by the <code>maskElement</code>. Note that the mask doesn’t need to be an image, it can be any arbitrary view. The behavior of the above example would be to render the blue view, but for it to be visible only where the words “Basic Mask” are from the <code>maskElement</code>. We just made complicated blue text.</p>
<p>What we want to do is render our blue layer, and then on top render our masked app and white layers with the Twitter logo.</p>
<pre><code class="hljs css language-jsx"><span class="token punctuation">{</span>
  fullScreenBlueLayer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MaskedViewIOS</span></span>
  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> flex<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">maskElement</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>centeredFullScreen<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Image</span></span> <span class="token attr-name">source</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>twitterLogo<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>fullScreenWhiteLayer<span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> flex<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyApp</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MaskedViewIOS</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
</code></pre>
<p>This will give us the layers we see below.</p>
<p><img src="/blog/assets/loading-screen-04.png" style="margin-left: auto; margin-right: auto; display: block" /></p>
<h2><a class="anchor" aria-hidden="true" id="now-for-the-animated-part"></a><a href="#now-for-the-animated-part" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Now for the Animated part</h2>
<p>We have all the pieces we need to make this work, the next step is animating them. To make this animation feel good, we will be utilizing React Native’s <a href="/docs/animated.html">Animated</a> API.</p>
<p>Animated lets us define our animations declaratively in JavaScript. By default, these animations run in JavaScript and tell the native layer what changes to make on every frame. Even though JavaScript will try to update the animation every frame, it will likely not be able to do that fast enough and will cause dropped frames (jank) to occur. Not what we want!</p>
<p>Animated has special behavior to allow you to get animations without this jank. Animated has a flag called <code>useNativeDriver</code> which sends your animation definition from JavaScript to native at the beginning of your animation, allowing the native side to process the updates to your animation without having to go back and forth to JavaScript every frame. The downside of <code>useNativeDriver</code> is you can only update a specific set of properties, mostly <code>transform</code> and <code>opacity</code>. You can’t animate things like background color with <code>useNativeDriver</code>, at least not yet — we will add more over time, and of course you can always submit a PR for properties you need for your project, benefitting the whole community 😀.</p>
<p>Since we want this animation to be smooth, we will work within these constraints. For a more in depth look at how <code>useNativeDriver</code> works under the hood, check out our <a href="/blog/2017/02/14/using-native-driver-for-animated.html">blog post announcing it</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="breaking-down-our-animation"></a><a href="#breaking-down-our-animation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Breaking down our animation</h2>
<p>There are 4 components to our animation:</p>
<ol>
<li>Enlarge the bird, revealing the app and the solid white layer</li>
<li>Fade in the app</li>
<li>Scale down the app</li>
<li>Hide the white layer and blue layer when it is done</li>
</ol>
<p>With Animated, there are two main ways to define your animation. The first is by using <code>Animated.timing</code> which lets you say exactly how long your animation will run for, along with an easing curve to smooth out the motion. The other approach is by using the physics based apis such as <code>Animated.spring</code>. With <code>Animated.spring</code>, you specify parameters like the amount of friction and tension in the spring, and let physics run your animation.</p>
<p>We have multiple animations we want to be running at the same time which are all closely related to each other. For example, we want the app to start fading in while the mask is mid-reveal. Because these animations are closely related, we will use <code>Animated.timing</code> with a single <code>Animated.Value</code>.</p>
<p><code>Animated.Value</code> is a wrapper around a native value that Animated uses to know the state of an animation. You typically want to only have one of these for a complete animation. Most components that use Animated will store the value in state.</p>
<p>Since I’m thinking about this animation as steps occurring at different points in time along the complete animation, we will start our <code>Animated.Value</code> at 0, representing 0% complete, and end our value at 100, representing 100% complete.</p>
<p>Our initial component state will be the following.</p>
<pre><code class="hljs css language-jsx">state <span class="token operator">=</span> <span class="token punctuation">{</span>
  loadingProgress<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Animated<span class="token punctuation">.</span>Value</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>When we are ready to begin the animation, we tell Animated to animate this value to 100.</p>
<pre><code class="hljs css language-jsx">Animated<span class="token punctuation">.</span><span class="token function">timing</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>loadingProgress<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  toValue<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  duration<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  useNativeDriver<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// This is important!</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>I then try to figure out a rough estimate of the different pieces of the animations and the values I want them to have at different stages of the overall animation. Below is a table of the different pieces of the animation, and what I think their values should be at different points as we progress through time.</p>
<p><img src="/blog/assets/loading-screen-05.png" alt=""></p>
<p>The Twitter bird mask should start at scale 1, and it gets smaller before it shoots up in size. So at 10% through the animation, it should have a scale value of .8 before shooting up to scale 70 at the end. Picking 70 was pretty arbitrary to be honest, it needed to be large enough that the bird fully revealed the screen and 60 wasn’t big enough 😀. Something interesting about this part though is that the higher the number, the faster it will look like it is growing because it has to get there in the same amount of time. This number took some trial and error to make look good with this logo. Logos / devices of different sizes will require this end-scale to be different to ensure the entire screen is revealed.</p>
<p>The app should stay opaque for a while, at least through the Twitter logo getting smaller. Based on the official animation, I want to start showing it when the bird is mid way through scaling it up and to fully reveal it pretty quickly. So at 15% we start showing it, and at 30% through the overall animation it is fully visible.</p>
<p>The app scale starts at 1.1 and scales down to its regular scale by the end of the animation.</p>
<h2><a class="anchor" aria-hidden="true" id="and-now-in-code"></a><a href="#and-now-in-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>And now, in code.</h2>
<p>What we essentially did above is map the values from the animation progress percentage to the values for the individual pieces. We do that with Animated using <code>.interpolate</code>. We create 3 different style objects, one for each piece of the animation, using interpolated values based off of <code>this.state.loadingProgress</code>.</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">const</span> loadingProgress <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>loadingProgress<span class="token punctuation">;</span>

<span class="token keyword">const</span> opacityClearToVisible <span class="token operator">=</span> <span class="token punctuation">{</span>
  opacity<span class="token punctuation">:</span> loadingProgress<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    inputRange<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    outputRange<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    extrapolate<span class="token punctuation">:</span> <span class="token string">'clamp'</span>
    <span class="token comment">// clamp means when the input is 30-100, output should stay at 1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> imageScale <span class="token operator">=</span> <span class="token punctuation">{</span>
  transform<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      scale<span class="token punctuation">:</span> loadingProgress<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        inputRange<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        outputRange<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> appScale <span class="token operator">=</span> <span class="token punctuation">{</span>
  transform<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      scale<span class="token punctuation">:</span> loadingProgress<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        inputRange<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        outputRange<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Now that we have these style objects, we can use them when rendering the snippet of the view from earlier in the post. Note that only <code>Animated.View</code>, <code>Animated.Text</code>, and <code>Animated.Image</code> are able to use style objects that use <code>Animated.Value</code>.</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">const</span> fullScreenBlueLayer <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>fullScreenBlueLayer<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fullScreenWhiteLayer <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>fullScreenWhiteLayer<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>fullScreen<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>fullScreenBlueLayer<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MaskedViewIOS</span></span>
      <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> flex<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">maskElement</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>centeredFullScreen<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Animated.Image</span></span>
            <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>styles<span class="token punctuation">.</span>maskImageStyle<span class="token punctuation">,</span> imageScale<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
            <span class="token attr-name">source</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>twitterLogo<span class="token punctuation">}</span></span>
          <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span>
      <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>fullScreenWhiteLayer<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Animated.View</span></span>
        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>opacityClearToVisible<span class="token punctuation">,</span> appScale<span class="token punctuation">,</span> <span class="token punctuation">{</span> flex<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Animated.View</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MaskedViewIOS</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="/blog/assets/loading-screen-06.gif" style="float: left; padding-right: 80px; padding-bottom: 20px"/></p>
<p>Yay! We now have the animation pieces looking like we want. Now we just have to clean up our blue and white layers which will never be seen again.</p>
<p>To know when we can clean them up, we need to know when the animation is complete. Luckily where we call, <code>Animated.timing</code> ,<code>.start</code> takes an optional callback that runs when the animation is complete.</p>
<pre><code class="hljs css language-jsx">Animated<span class="token punctuation">.</span><span class="token function">timing</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>loadingProgress<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  toValue<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  duration<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  useNativeDriver<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    animationDone<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Now that we have a value in <code>state</code> to know whether we are done with the animation, we can modify our blue and white layers to use that.</p>
<pre><code class="hljs css language-jsx"><span class="token keyword">const</span> fullScreenBlueLayer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>animationDone <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>styles<span class="token punctuation">.</span>fullScreenBlueLayer<span class="token punctuation">]</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fullScreenWhiteLayer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>animationDone <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>styles<span class="token punctuation">.</span>fullScreenWhiteLayer<span class="token punctuation">]</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Voila! Our animation now works and we clean up our unused layers once the animation is done. We have built the Twitter app loading animation!</p>
<h2><a class="anchor" aria-hidden="true" id="but-wait-mine-doesnt-work"></a><a href="#but-wait-mine-doesnt-work" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>But wait, mine doesn’t work!</h2>
<p>Don’t fret, dear reader. I too hate when guides only give you chunks of the code and don’t give you the completed source.</p>
<p>This component has been published to npm and is on GitHub as <a href="https://github.com/TheSavior/react-native-mask-loader">react-native-mask-loader</a>. To try this out on your phone, it is <a href="https://expo.io/@eliwhite/react-native-mask-loader-example">available on Expo</a> here:</p>
<p><img src="/blog/assets/loading-screen-07.png" style="margin-left: auto; margin-right: auto; display: block" /></p>
<h2><a class="anchor" aria-hidden="true" id="more-reading--extra-credit"></a><a href="#more-reading--extra-credit" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>More Reading / Extra Credit</h2>
<ol>
<li><a href="http://browniefed.com/react-native-animation-book/">This gitbook</a> is a great resource to learn more about Animated after you have read the React Native docs.</li>
<li>The actual Twitter animation seems to speed up the mask reveal towards the end. Try modifying the loader to use a different easing function (or a spring!) to better match that behavior.</li>
<li>The current end-scale of the mask is hard coded and likely won’t reveal the entire app on a tablet. Calculating the end scale based on screen size and image size would be an awesome PR.</li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev" href="/blog/">← Prev</a><a class="docs-next" href="/blog/page3/">Next →</a></div></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Docs</h5><a href="/docs/getting-started">Getting Started</a><a href="/docs/tutorial">Tutorial</a><a href="/docs/components-and-apis">Components and APIs</a><a href="/docs/more-resources">More Resources</a></div><div><h5>Community</h5><a href="/help">The React Native Community</a><a href="/showcase">Who&#x27;s using React Native?</a><a href="https://stackoverflow.com/questions/tagged/react-native" target="_blank">Ask Questions on Stack Overflow</a><a href="https://github.com/facebook/react-native/blob/master/CONTRIBUTING.md">Contributor Guide</a><a href="https://dev.to/t/reactnative" target="_blank">DEV Community</a></div><div><h5>More Resources</h5><a href="/blog">Blog</a><a href="https://twitter.com/reactnative" target="_blank">Twitter</a><a href="https://github.com/facebook/react-native" target="_blank">GitHub</a><a href="https://reactjs.org" target="_blank">React</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook Inc.</section></footer></div><script type="text/javascript" src="/cdn/docsearch.min.js"></script><script>window.fbAsyncInit = function() {FB.init({appId:'1677033832619985',xfbml:true,version:'v2.7'});};(function(d, s, id){var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) {return;}js = d.createElement(s); js.id = id;js.src = '//connect.facebook.net/en_US/sdk.js';fjs.parentNode.insertBefore(js, fjs);}(document, 'script','facebook-jssdk'));
                </script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='/cdn/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2c98749b4a1e588efec53b2acec13025',
                indexName: 'react-native-versions',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["tags:0.62"],"hitsPerPage":5}
              });
            </script></body></html>